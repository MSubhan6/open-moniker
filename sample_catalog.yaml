# Moniker Catalog Definition
#
# Format: [namespace@]domain.subdomain/path/segments[@version][/vN]
#
# Each entry defines:
#   - ownership: Accountable owner, data specialist, support channel
#   - source_binding: How to fetch data (snowflake, oracle, rest, static, excel, opensearch, etc.)
#
# Ownership inherits down the hierarchy. Source bindings define leaf nodes.
#
# Query templates support placeholders:
#   {path}         - Full sub-path after the binding
#   {segments[N]}  - Specific path segment (0-indexed)
#   {version}      - Version from @suffix (e.g., @20260115, @latest)
#   {revision}     - Revision from /vN suffix
#   {namespace}    - Namespace prefix if provided


# =============================================================================
# INDICES - Benchmark indices and aggregates
# =============================================================================

indices:
  display_name: Market Indices
  description: Benchmark indices, aggregates, and composites
  ownership:
    accountable_owner: indices-governance@firm.com
    data_specialist: quant-research@firm.com
    support_channel: "#indices-support"

indices.sovereign:
  display_name: Sovereign Indices
  description: Government bond indices by region and currency

# Example: indices.sovereign/developed/EU.GovBondAgg/EUR/ALL
# Using {filter[N]:col} for ALL support and {version_date} for date handling
indices.sovereign/developed:
  display_name: Developed Markets Sovereign
  description: DM government bond benchmarks
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: ANALYTICS_WH
      database: INDICES
      schema: SOVEREIGN
      query: |
        SELECT index_id, index_name, currency, weight, yield, duration, mod_duration
        FROM DM_SOVEREIGN_INDICES
        WHERE {filter[0]:index_family}
          AND {filter[1]:currency}
          AND as_of_date = {version_date}

indices.corporate:
  display_name: Corporate Indices
  description: Investment grade and high yield corporate bond indices
  ownership:
    data_specialist: credit-research@firm.com

indices.corporate/ig:
  display_name: Investment Grade Corporate
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: ANALYTICS_WH
      database: INDICES
      schema: CORPORATE
      query: |
        SELECT index_id, sector, rating_bucket, spread, oas, duration
        FROM IG_CORPORATE_INDICES
        WHERE sector = '{segments[0]}'


# =============================================================================
# COMMODITIES - Futures, spot, and derivatives
# =============================================================================

commodities:
  display_name: Commodities
  description: Commodity futures, spot prices, and derivatives
  ownership:
    accountable_owner: commodities-desk@firm.com
    data_specialist: commodities-quant@firm.com
    support_channel: "#commodities-data"

commodities.derivatives:
  display_name: Commodity Derivatives
  description: Futures and options on commodities

# Example: commodities.derivatives/energy/ALL
commodities.derivatives/energy:
  display_name: Energy Derivatives
  description: Crude, natural gas, power futures
  source_binding:
    type: rest
    config:
      base_url: https://market-data.internal.firm.com
      path_template: /api/v2/commodities/energy/{path}
      method: GET
      auth_type: bearer
      headers:
        Accept: application/json
      response_format: json

commodities.derivatives/metals:
  display_name: Precious Metals
  source_binding:
    type: rest
    config:
      base_url: https://market-data.internal.firm.com
      path_template: /api/v2/commodities/metals/{path}
      method: GET
      auth_type: bearer

# Example: commodities.derivatives/crypto/ETH@20260115/v2
commodities.derivatives/crypto:
  display_name: Digital Assets
  description: Cryptocurrency spot and derivatives
  ownership:
    data_specialist: digital-assets@firm.com
  source_binding:
    type: rest
    config:
      base_url: https://crypto-data.internal.firm.com
      path_template: /api/v3/assets/{segments[0]}
      method: GET
      auth_type: api_key
      # Supports versioning: @20260115 becomes as_of query param
      query_params:
        as_of: "{version}"
        schema_version: "{revision}"


# =============================================================================
# REFERENCE - Security master, calendars, static data
# =============================================================================

reference:
  display_name: Reference Data
  description: Security master, calendars, and static reference data
  ownership:
    accountable_owner: ref-data-governance@firm.com
    data_specialist: ref-data-ops@firm.com
    support_channel: "#reference-data"
  classification: internal

reference.security:
  display_name: Security Master
  description: Canonical security identifiers and attributes

# Example: verified@reference.security/ISIN/US0378331005@latest
# The "verified" namespace indicates official/golden source
reference.security/ISIN:
  display_name: ISIN Lookup
  description: International Securities Identification Numbers
  source_binding:
    type: oracle
    config:
      dsn: secmaster.firm.com:1521/SECMASTER
      query: |
        SELECT isin, cusip, sedol, ticker, issuer_name,
               country_code, currency, security_type, active_flag
        FROM SECURITY_MASTER
        WHERE isin = '{segments[0]}'
          AND effective_date = NVL(TO_DATE('{version}', 'YYYYMMDD'), TRUNC(SYSDATE))

reference.security/CUSIP:
  display_name: CUSIP Lookup
  source_binding:
    type: oracle
    config:
      dsn: secmaster.firm.com:1521/SECMASTER
      query: |
        SELECT isin, cusip, sedol, ticker, issuer_name,
               country_code, currency, security_type, active_flag
        FROM SECURITY_MASTER
        WHERE cusip = '{segments[0]}'

reference.security/SEDOL:
  display_name: SEDOL Lookup
  source_binding:
    type: oracle
    config:
      dsn: secmaster.firm.com:1521/SECMASTER
      query: |
        SELECT isin, cusip, sedol, ticker, issuer_name,
               country_code, currency, security_type, active_flag
        FROM SECURITY_MASTER
        WHERE sedol = '{segments[0]}'

reference.calendars:
  display_name: Trading Calendars
  description: Exchange and settlement calendars

reference.calendars/exchange:
  display_name: Exchange Calendars
  source_binding:
    type: static
    config:
      base_path: /data/reference/calendars/exchange
      file_pattern: "{segments[0]}.json"
      format: json

reference.calendars/settlement:
  display_name: Settlement Calendars
  source_binding:
    type: static
    config:
      base_path: /data/reference/calendars/settlement
      file_pattern: "{segments[0]}.csv"
      format: csv


# =============================================================================
# INSTRUMENTS - Detailed security attributes
# =============================================================================

instruments:
  display_name: Instrument Details
  description: Detailed security attributes and terms
  ownership:
    accountable_owner: ref-data-governance@firm.com
    data_specialist: security-ops@firm.com
    support_channel: "#instruments"

# Example: instruments/US0378331005/metadata
instruments/metadata:
  display_name: Instrument Metadata
  description: Security terms, attributes, and classifications
  source_binding:
    type: opensearch
    config:
      hosts:
        - https://search.internal.firm.com:9200
      index: instruments-v2
      query: |
        {
          "query": {
            "bool": {
              "must": [
                {"term": {"security_id": "{segments[0]}"}}
              ]
            }
          }
        }


# =============================================================================
# ANALYTICS - Risk, attribution, and calculated metrics
# =============================================================================

analytics:
  display_name: Analytics
  description: Risk metrics, attribution, and calculated analytics
  ownership:
    accountable_owner: risk-governance@firm.com
    data_specialist: quant-analytics@firm.com
    support_channel: "#analytics-support"
  classification: confidential

analytics.risk:
  display_name: Risk Analytics
  description: VaR, stress tests, sensitivities

analytics.risk/var:
  display_name: Value at Risk
  source_binding:
    type: rest
    config:
      base_url: https://risk-engine.internal.firm.com
      path_template: /api/v2/var/{path}
      method: GET
      auth_type: bearer

analytics.risk/stress:
  display_name: Stress Testing
  source_binding:
    type: rest
    config:
      base_url: https://risk-engine.internal.firm.com
      path_template: /api/v2/stress/{path}
      method: GET
      auth_type: bearer

# Example: user@analytics.risk/views/my-watchlist@20260115/v3
# User-scoped views require namespace prefix
analytics.risk/views:
  display_name: User Risk Views
  description: Saved user views and filters (namespace required)
  source_binding:
    type: rest
    config:
      base_url: https://risk-engine.internal.firm.com
      path_template: /api/v2/views/{namespace}/{segments[0]}
      method: GET
      auth_type: bearer
      query_params:
        as_of: "{version}"
        version: "{revision}"


# =============================================================================
# RISK - CVaR and tail risk measures (Oracle)
# =============================================================================

risk:
  display_name: Risk Measures
  description: Tail risk, CVaR, and stress testing metrics from Proteus
  ownership:
    accountable_owner: risk-governance@firm.com
    data_specialist: risk-quant@firm.com
    support_channel: "#risk-analytics"
  classification: confidential

# Example monikers:
#   risk.cvar/758-A/USD/ALL         - All securities for portfolio 758-A in USD
#   risk.cvar/758-A/ALL/ALL         - All currencies, all securities for portfolio
#   risk.cvar/ALL/USD/B0YHY8V7      - Specific security across all USD portfolios
#   risk.cvar/ALL/ALL/ALL           - Everything (use with caution!)
#
# Path structure: risk.cvar/{portfolio}/{currency}/{security}
#   - portfolio: PORT_NO-PORT_TYPE combined (e.g., "758-A")
#   - currency: BASE_CURRENCY (e.g., "USD") or "ALL"
#   - security: SSM_ID (e.g., "B0YHY8V7") or "ALL"
#
# Returns full timeseries history (ASOF_DATE is a result column, not a filter)

risk.cvar:
  display_name: Conditional Value at Risk
  description: CVaR tail risk measures by portfolio, currency, and security
  classification: confidential

  ownership:
    # Simplified ownership
    accountable_owner: risk-governance@firm.com
    data_specialist: risk-quant@firm.com
    support_channel: "#risk-analytics"
    # Formal data governance roles (BCBS 239 / DAMA)
    adop: quant-research@firm.com        # Accountable Data Owner/Principal - business executive
    ads: risk-data-steward@firm.com       # Accountable Data Steward - data quality & standards
    adal: risk-access-control@firm.com    # Accountable Data Access Lead - access & permissions

  # Data Quality information
  data_quality:
    dq_owner: dq-risk-team@firm.com
    quality_score: 94.5
    validation_rules:
      - "CVAR values must be between -1 and 1"
      - "No null SSM_ID values"
      - "ASOF_DATE must be a valid business day"
    known_issues:
      - "Some legacy positions from 2019 have missing LT_ID mappings"
    last_validated: "2026-01-28T06:00:00Z"

  # SLA commitments
  sla:
    freshness: "T+1 by 06:00 ET"
    availability: "99.5%"
    support_hours: "Business hours ET (8am-6pm)"
    escalation_contact: risk-oncall@firm.com

  # Data freshness
  freshness:
    last_loaded: "2026-01-28T05:45:00Z"
    refresh_schedule: "Daily at 05:30 ET"
    source_system: "Proteus Risk Engine"
    upstream_dependencies:
      - "positions.eod"
      - "market-data.eod"
      - "reference.security"

  # Machine-readable schema for AI agent discoverability
  schema:
    description: |
      Conditional Value at Risk (CVaR) tail risk measures from the Proteus risk engine.
      Contains daily risk metrics per portfolio, currency, and security combination.
      CVaR represents the expected loss given that the loss exceeds the VaR threshold,
      providing insight into tail risk exposure.

    semantic_tags:
      - risk
      - cvar
      - tail-risk
      - timeseries
      - financial
      - portfolio-analytics
      - stress-testing
      - regulatory

    granularity: "daily, per-portfolio, per-currency, per-security"
    typical_row_count: "1M-100M"
    update_frequency: "daily (T+1)"

    primary_key:
      - ASOF_DATE
      - PORT_NO
      - PORT_TYPE
      - SSM_ID
      - BASE_CURRENCY

    columns:
      - name: ASOF_DATE
        type: date
        description: "Business date for the risk calculation (T+1 from market close)"
        semantic_type: timestamp
        example: "2026-01-28"
        nullable: false
        primary_key: true

      - name: PORT_NO
        type: string
        description: "Portfolio number identifier"
        semantic_type: identifier
        example: "758"
        nullable: false
        primary_key: true

      - name: PORT_TYPE
        type: string
        description: "Portfolio type classification (A=Active, B=Benchmark)"
        semantic_type: dimension
        example: "A"
        nullable: false
        primary_key: true

      - name: SSM_ID
        type: string
        description: "Security master identifier - unique security ID from SSM system"
        semantic_type: identifier
        example: "B0YHY8V7"
        nullable: false
        primary_key: true
        foreign_key: "reference.security/SSM"

      - name: BASE_CURRENCY
        type: string
        description: "Base currency for the CVaR calculation (ISO 4217)"
        semantic_type: dimension
        example: "USD"
        nullable: false
        primary_key: true

      - name: ACCT_KEY
        type: string
        description: "Account key for position attribution"
        semantic_type: identifier
        example: "758-IDX-16220-[TPH200010]"
        nullable: true

      - name: LT_ID
        type: integer
        description: "Liquidity tier ID (0=liquid, 24=illiquid)"
        semantic_type: dimension
        example: "0"
        nullable: true

      - name: LT_ID_2
        type: integer
        description: "Secondary liquidity tier for override scenarios"
        semantic_type: dimension
        example: "null"
        nullable: true

      - name: CVAR_COEFF
        type: float
        description: "CVaR coefficient - sensitivity factor for the position"
        semantic_type: measure
        example: "-0.00005"
        nullable: false

      - name: CVAR
        type: float
        description: "Conditional Value at Risk - expected loss in tail scenarios (decimal)"
        semantic_type: measure
        example: "-0.0152"
        nullable: false

    use_cases:
      - "Calculate portfolio-level tail risk exposure"
      - "Monitor daily CVaR changes for risk limits"
      - "Compare CVaR across currencies for hedging decisions"
      - "Identify high-risk securities for portfolio optimization"
      - "Regulatory reporting (BCBS 239, FRTB)"
      - "Stress testing and scenario analysis"

    examples:
      - "risk.cvar/758-A/USD/ALL - All USD securities in portfolio 758-A"
      - "risk.cvar/ALL/USD/B0YHY8V7 - Security B0YHY8V7 across all USD portfolios"
      - "risk.cvar/ALL/ALL/ALL - Full dataset (caution: large)"

    related_monikers:
      - "positions.eod - End of day position data"
      - "market-data.eod - Market prices used in calculation"
      - "reference.security/SSM - Security master for SSM_ID lookups"
      - "analytics.risk/var - Value at Risk (related metric)"

  source_binding:
    type: oracle
    config:
      dsn: proteus.firm.com:1521/RISKDB
      query: |
        SELECT asof_date, port_no, port_type, ssm_id, base_currency,
               acct_key, lt_id, lt_id_2, cvar_coeff, cvar
        FROM proteus_2_own.te_stress_tail_risk_pnl
        WHERE ('{segments[0]}' = 'ALL' OR port_no || '-' || port_type = '{segments[0]}')
          AND ('{segments[1]}' = 'ALL' OR base_currency = '{segments[1]}')
          AND ('{segments[2]}' = 'ALL' OR ssm_id = '{segments[2]}')
        ORDER BY asof_date DESC, port_no, ssm_id


# =============================================================================
# HOLDINGS - Portfolio positions and exposures
# =============================================================================

holdings:
  display_name: Holdings & Positions
  description: Portfolio positions, exposures, and allocations
  ownership:
    accountable_owner: portfolio-ops@firm.com
    data_specialist: position-management@firm.com
    support_channel: "#positions"
  classification: confidential

# Example: holdings/20260115/fund_alpha
holdings/positions:
  display_name: Position Data
  description: End of day positions by date and portfolio
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: POSITIONS_WH
      database: HOLDINGS
      schema: POSITIONS
      query: |
        SELECT portfolio_id, security_id, quantity, market_value,
               cost_basis, unrealized_pnl, currency
        FROM DAILY_POSITIONS
        WHERE as_of_date = TO_DATE('{segments[0]}', 'YYYYMMDD')
          AND portfolio_id = '{segments[1]}'

holdings/exposures:
  display_name: Exposure Analysis
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: ANALYTICS_WH
      database: HOLDINGS
      schema: ANALYTICS
      query: |
        SELECT portfolio_id, dimension, bucket, exposure_pct, notional
        FROM EXPOSURE_BREAKDOWN
        WHERE as_of_date = TO_DATE('{segments[0]}', 'YYYYMMDD')
          AND portfolio_id = '{segments[1]}'


# =============================================================================
# REPORTS - Generated reports and exports
# =============================================================================

reports:
  display_name: Reports
  description: Generated reports, exports, and documents
  ownership:
    accountable_owner: reporting-ops@firm.com
    data_specialist: report-dev@firm.com
    support_channel: "#reporting"

reports/daily:
  display_name: Daily Reports
  source_binding:
    type: static
    config:
      base_path: /data/reports/daily
      file_pattern: "{segments[0]}/{segments[1]}.pdf"
      format: binary

reports/regulatory:
  display_name: Regulatory Reports
  classification: restricted
  source_binding:
    type: excel
    config:
      base_path: /data/reports/regulatory
      file_pattern: "{segments[0]}/{segments[1]}.xlsx"
      sheet: Summary


# =============================================================================
# PRICES - Real-time and historical prices
# =============================================================================

prices:
  display_name: Market Prices
  description: Real-time and historical security prices
  ownership:
    accountable_owner: market-data-governance@firm.com
    data_specialist: market-data-ops@firm.com
    support_channel: "#market-data"

# Example: prices.equity/AAPL@20260115 or prices.equity/ALL@latest
prices.equity:
  display_name: Equity Prices
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: PRICES
      schema: EQUITY
      query: |
        SELECT symbol, open_price, high_price, low_price, close_price, volume, vwap
        FROM EQUITY_EOD
        WHERE {filter[0]:symbol}
          AND trade_date = CASE
            WHEN {is_latest} = 'true' THEN (SELECT MAX(trade_date) FROM EQUITY_EOD)
            ELSE {version_date}
          END

prices.fx:
  display_name: FX Rates
  source_binding:
    type: rest
    config:
      base_url: https://fx-service.internal.firm.com
      path_template: /api/v1/rates/{segments[0]}/{segments[1]}
      method: GET
      auth_type: bearer

prices.fixed-income:
  display_name: Fixed Income Prices
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: PRICES
      schema: FIXED_INCOME
      query: |
        SELECT security_id, bid_price, ask_price, mid_price, yield_to_maturity, spread
        FROM BOND_PRICES
        WHERE security_id = '{segments[0]}'


# =============================================================================
# GOVIES - Government Bond Data (Snowflake)
# =============================================================================

govies:
  display_name: Government Bonds
  description: Sovereign debt securities, yields, and analytics
  ownership:
    accountable_owner: fixed-income-governance@firm.com
    data_specialist: govies-desk@firm.com
    support_channel: "#govies-data"
    adop: fi-trading-head@firm.com
    ads: govies-data-steward@firm.com
    adal: fi-access-control@firm.com
  classification: internal

# Example monikers:
#   govies.treasury/US/10Y/ALL      - All 10Y US Treasury data
#   govies.treasury/ALL/ALL/ALL     - All treasury data
#   govies.sovereign/DE/5Y/ALL      - German 5Y bunds
govies.treasury:
  display_name: US Treasury Securities
  description: US Treasury bills, notes, and bonds with yields and pricing

  data_quality:
    dq_owner: fi-dq-team@firm.com
    quality_score: 98.2
    validation_rules:
      - "Yield must be positive for non-TIPS securities"
      - "Maturity date must be in the future"
      - "CUSIP must be valid 9-character format"
    last_validated: "2026-01-28T07:00:00Z"

  sla:
    freshness: "T+0 by 18:00 ET"
    availability: "99.9%"
    support_hours: "24/5 (Mon-Fri)"
    escalation_contact: fi-oncall@firm.com

  freshness:
    last_loaded: "2026-01-28T17:45:00Z"
    refresh_schedule: "Continuous during market hours"
    source_system: "Treasury Direct / Bloomberg"
    upstream_dependencies:
      - "reference.security"
      - "market-data.rates"

  schema:
    description: |
      US Treasury securities including T-Bills, Notes, and Bonds.
      Contains pricing, yield curve data, and duration analytics.
      Primary source for risk-free rate benchmarking.

    semantic_tags:
      - government-bonds
      - treasury
      - fixed-income
      - yield-curve
      - risk-free-rate
      - sovereign
      - timeseries

    granularity: "daily, per-security, per-tenor"
    typical_row_count: "10K-100K"
    update_frequency: "continuous (market hours)"

    primary_key:
      - ASOF_DATE
      - CUSIP
      - TENOR

    columns:
      - name: ASOF_DATE
        type: date
        description: "Pricing date"
        semantic_type: timestamp
        example: "2026-01-28"
        nullable: false
        primary_key: true

      - name: CUSIP
        type: string
        description: "CUSIP identifier for the security"
        semantic_type: identifier
        example: "912828ZT5"
        nullable: false
        primary_key: true
        foreign_key: "reference.security/CUSIP"

      - name: COUNTRY
        type: string
        description: "Issuing country (ISO 3166-1 alpha-2)"
        semantic_type: dimension
        example: "US"
        nullable: false

      - name: TENOR
        type: string
        description: "Maturity tenor bucket (3M, 6M, 1Y, 2Y, 5Y, 10Y, 30Y)"
        semantic_type: dimension
        example: "10Y"
        nullable: false
        primary_key: true

      - name: COUPON
        type: float
        description: "Annual coupon rate (decimal)"
        semantic_type: measure
        example: "0.0375"
        nullable: false

      - name: YIELD
        type: float
        description: "Yield to maturity (decimal)"
        semantic_type: measure
        example: "0.0425"
        nullable: false

      - name: PRICE
        type: float
        description: "Clean price (percentage of par)"
        semantic_type: measure
        example: "98.75"
        nullable: false

      - name: DURATION
        type: float
        description: "Modified duration (years)"
        semantic_type: measure
        example: "8.45"
        nullable: false

      - name: CONVEXITY
        type: float
        description: "Convexity measure"
        semantic_type: measure
        example: "0.85"
        nullable: true

    use_cases:
      - "Build yield curve for discounting"
      - "Calculate duration and convexity for portfolio"
      - "Monitor Treasury market movements"
      - "Benchmark against risk-free rate"
      - "Regulatory capital calculations"

    examples:
      - "govies.treasury/US/10Y/ALL - All 10Y Treasury data"
      - "govies.treasury/US/ALL/ALL - Full US Treasury curve"
      - "govies.treasury/ALL/ALL/912828ZT5 - Specific CUSIP history"

    related_monikers:
      - "rates.swap - Interest rate swaps for spread analysis"
      - "reference.security/CUSIP - Security master lookup"
      - "risk.cvar - CVaR calculations using treasuries"

  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: FIXED_INCOME
      schema: GOVIES
      query: |
        SELECT asof_date, cusip, country, tenor, coupon, yield, price, duration, convexity
        FROM TREASURY_SECURITIES
        WHERE ('{segments[0]}' = 'ALL' OR country = '{segments[0]}')
          AND ('{segments[1]}' = 'ALL' OR tenor = '{segments[1]}')
          AND ('{segments[2]}' = 'ALL' OR cusip = '{segments[2]}')
        ORDER BY asof_date DESC, tenor

govies.sovereign:
  display_name: International Sovereign Bonds
  description: Non-US government bonds (Bunds, Gilts, JGBs, etc.)

  schema:
    description: |
      International sovereign debt from major developed markets.
      Includes German Bunds, UK Gilts, Japanese JGBs, and other G10 sovereigns.

    semantic_tags:
      - government-bonds
      - sovereign
      - international
      - fixed-income
      - bunds
      - gilts
      - jgbs

    granularity: "daily, per-country, per-tenor"
    typical_row_count: "50K-500K"
    update_frequency: "daily (T+1)"

    columns:
      - name: ASOF_DATE
        type: date
        description: "Pricing date"
        semantic_type: timestamp
        example: "2026-01-28"

      - name: ISIN
        type: string
        description: "International Securities Identification Number"
        semantic_type: identifier
        example: "DE0001102481"
        foreign_key: "reference.security/ISIN"

      - name: COUNTRY
        type: string
        description: "Issuing country (ISO 3166-1 alpha-2)"
        semantic_type: dimension
        example: "DE"

      - name: TENOR
        type: string
        description: "Maturity tenor"
        semantic_type: dimension
        example: "10Y"

      - name: YIELD
        type: float
        description: "Yield to maturity (decimal)"
        semantic_type: measure
        example: "0.0215"

      - name: SPREAD_VS_USD
        type: float
        description: "Spread versus comparable US Treasury (bps)"
        semantic_type: measure
        example: "-125.5"

    use_cases:
      - "Cross-market yield comparisons"
      - "Currency-hedged return analysis"
      - "Global duration management"

    examples:
      - "govies.sovereign/DE/10Y/ALL - German 10Y Bunds"
      - "govies.sovereign/GB/ALL/ALL - All UK Gilts"

  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: FIXED_INCOME
      schema: GOVIES
      query: |
        SELECT asof_date, isin, country, tenor, yield, spread_vs_usd, price, duration
        FROM SOVEREIGN_BONDS
        WHERE ('{segments[0]}' = 'ALL' OR country = '{segments[0]}')
          AND ('{segments[1]}' = 'ALL' OR tenor = '{segments[1]}')
          AND ('{segments[2]}' = 'ALL' OR isin = '{segments[2]}')
        ORDER BY asof_date DESC, country, tenor


# =============================================================================
# COMMODS - Commodities Data (REST API - NEFA)
# =============================================================================

commods:
  display_name: Commodities
  description: Commodity futures, spot prices, and physical market data
  ownership:
    accountable_owner: commodities-governance@firm.com
    data_specialist: commods-quant@firm.com
    support_channel: "#commodities-data"
    adop: commods-trading-head@firm.com
    ads: commods-data-steward@firm.com
    adal: commods-access-control@firm.com
  classification: internal

# Example monikers:
#   commods.energy/CL/SPOT/ALL      - Crude oil spot prices
#   commods.energy/NG/F1/ALL        - Natural gas front month
#   commods.metals/GC/SPOT/ALL      - Gold spot prices
commods.energy:
  display_name: Energy Commodities
  description: Crude oil, natural gas, and refined products from NEFA API

  data_quality:
    dq_owner: commods-dq@firm.com
    quality_score: 96.8
    validation_rules:
      - "Price must be positive"
      - "Volume must be non-negative"
      - "Contract codes must match exchange symbology"
    known_issues:
      - "Some illiquid contracts may have stale prices on low-volume days"
    last_validated: "2026-01-28T08:00:00Z"

  sla:
    freshness: "Real-time (15-min delay for non-pro)"
    availability: "99.5%"
    support_hours: "24/6 (Sun 6pm - Fri 5pm ET)"
    escalation_contact: commods-oncall@firm.com

  freshness:
    last_loaded: "2026-01-28T14:30:00Z"
    refresh_schedule: "Real-time via API"
    source_system: "NEFA Energy Data API"
    upstream_dependencies:
      - "reference.contracts"

  schema:
    description: |
      Energy commodity prices from the NEFA (National Energy & Futures API).
      Includes crude oil (WTI, Brent), natural gas, heating oil, gasoline,
      and other energy derivatives. Supports spot, futures, and spread data.

    semantic_tags:
      - commodities
      - energy
      - crude-oil
      - natural-gas
      - futures
      - spot
      - nefa
      - real-time

    granularity: "intraday, per-commodity, per-contract"
    typical_row_count: "100K-1M"
    update_frequency: "real-time"

    primary_key:
      - TIMESTAMP
      - SYMBOL
      - CONTRACT

    columns:
      - name: TIMESTAMP
        type: datetime
        description: "Price timestamp (UTC)"
        semantic_type: timestamp
        example: "2026-01-28T14:30:00Z"
        nullable: false
        primary_key: true

      - name: SYMBOL
        type: string
        description: "Commodity symbol (CL=Crude, NG=NatGas, HO=Heating Oil)"
        semantic_type: identifier
        example: "CL"
        nullable: false
        primary_key: true

      - name: CONTRACT
        type: string
        description: "Contract type (SPOT, F1=front month, F2=second month, etc.)"
        semantic_type: dimension
        example: "F1"
        nullable: false
        primary_key: true

      - name: PRICE
        type: float
        description: "Price per unit (USD)"
        semantic_type: measure
        example: "78.45"
        nullable: false

      - name: CHANGE
        type: float
        description: "Price change from prior close"
        semantic_type: measure
        example: "-0.52"
        nullable: true

      - name: CHANGE_PCT
        type: float
        description: "Percentage change from prior close"
        semantic_type: measure
        example: "-0.66"
        nullable: true

      - name: VOLUME
        type: integer
        description: "Trading volume (contracts)"
        semantic_type: measure
        example: "125000"
        nullable: true

      - name: OPEN_INTEREST
        type: integer
        description: "Open interest (contracts)"
        semantic_type: measure
        example: "450000"
        nullable: true

    use_cases:
      - "Real-time energy price monitoring"
      - "Futures curve analysis"
      - "Hedging strategy development"
      - "Correlation analysis with equity markets"
      - "Commodity-linked derivative pricing"

    examples:
      - "commods.energy/CL/SPOT/ALL - WTI Crude spot prices"
      - "commods.energy/CL/F1/ALL - Crude front month futures"
      - "commods.energy/NG/ALL/ALL - All natural gas contracts"

    related_monikers:
      - "commods.metals - Precious metals data"
      - "prices.fx - Currency rates for conversion"
      - "risk.cvar - Commodity portfolio risk"

  source_binding:
    type: rest
    config:
      base_url: https://api.nefa.energy
      path_template: /v2/commodities/energy/{segments[0]}/{segments[1]}
      method: GET
      auth_type: api_key
      headers:
        Accept: application/json
        X-API-Version: "2.0"
      query_params:
        format: json
        include_history: "true"

commods.metals:
  display_name: Precious & Industrial Metals
  description: Gold, silver, copper, and other metals from NEFA API

  schema:
    description: |
      Precious and industrial metals prices from NEFA.
      Includes gold (GC), silver (SI), copper (HG), platinum (PL), palladium (PA).

    semantic_tags:
      - commodities
      - metals
      - gold
      - silver
      - precious-metals
      - industrial-metals
      - futures

    granularity: "intraday, per-metal, per-contract"
    typical_row_count: "50K-200K"
    update_frequency: "real-time"

    columns:
      - name: TIMESTAMP
        type: datetime
        description: "Price timestamp (UTC)"
        semantic_type: timestamp
        example: "2026-01-28T14:30:00Z"

      - name: SYMBOL
        type: string
        description: "Metal symbol (GC=Gold, SI=Silver, HG=Copper)"
        semantic_type: identifier
        example: "GC"

      - name: CONTRACT
        type: string
        description: "Contract type (SPOT, F1, F2, etc.)"
        semantic_type: dimension
        example: "SPOT"

      - name: PRICE
        type: float
        description: "Price per troy oz (precious) or lb (industrial)"
        semantic_type: measure
        example: "2045.30"

      - name: CURRENCY
        type: string
        description: "Price currency (usually USD)"
        semantic_type: dimension
        example: "USD"

    use_cases:
      - "Precious metals portfolio tracking"
      - "Inflation hedge analysis"
      - "Industrial demand forecasting"

    examples:
      - "commods.metals/GC/SPOT/ALL - Gold spot prices"
      - "commods.metals/SI/F1/ALL - Silver front month"

  source_binding:
    type: rest
    config:
      base_url: https://api.nefa.energy
      path_template: /v2/commodities/metals/{segments[0]}/{segments[1]}
      method: GET
      auth_type: api_key
      headers:
        Accept: application/json


# =============================================================================
# RATES - Interest Rate Data (Snowflake)
# =============================================================================

rates:
  display_name: Interest Rates
  description: Interest rate curves, swaps, and money market rates
  ownership:
    accountable_owner: rates-governance@firm.com
    data_specialist: rates-quant@firm.com
    support_channel: "#rates-data"
    adop: rates-trading-head@firm.com
    ads: rates-data-steward@firm.com
    adal: rates-access-control@firm.com
  classification: internal

# Example monikers:
#   rates.swap/USD/5Y/ALL           - 5Y USD swap rates
#   rates.libor/USD/3M/ALL          - 3M USD LIBOR (legacy)
#   rates.sofr/USD/ON/ALL           - Overnight SOFR
rates.swap:
  display_name: Interest Rate Swaps
  description: Par swap rates across currencies and tenors

  data_quality:
    dq_owner: rates-dq@firm.com
    quality_score: 99.1
    validation_rules:
      - "Rate must be within reasonable bounds for currency"
      - "Curve must be monotonically increasing for normal conditions"
      - "Spread to benchmark must be calculated correctly"
    last_validated: "2026-01-28T06:30:00Z"

  sla:
    freshness: "T+0 by 17:00 local"
    availability: "99.9%"
    support_hours: "Business hours (regional)"
    escalation_contact: rates-oncall@firm.com

  freshness:
    last_loaded: "2026-01-28T16:45:00Z"
    refresh_schedule: "EOD snapshots + intraday updates"
    source_system: "Bloomberg / Refinitiv"
    upstream_dependencies:
      - "rates.sofr"
      - "reference.calendars"

  schema:
    description: |
      Interest rate swap par rates for major currencies.
      Used for discounting, yield curve construction, and derivative pricing.
      Includes USD, EUR, GBP, JPY, and other G10 currencies.

    semantic_tags:
      - interest-rates
      - swaps
      - yield-curve
      - derivatives
      - discounting
      - sofr
      - euribor
      - fixed-income

    granularity: "daily, per-currency, per-tenor"
    typical_row_count: "10K-50K"
    update_frequency: "daily + intraday"

    primary_key:
      - ASOF_DATE
      - CURRENCY
      - TENOR

    columns:
      - name: ASOF_DATE
        type: date
        description: "Rate observation date"
        semantic_type: timestamp
        example: "2026-01-28"
        nullable: false
        primary_key: true

      - name: CURRENCY
        type: string
        description: "Currency (ISO 4217)"
        semantic_type: dimension
        example: "USD"
        nullable: false
        primary_key: true

      - name: TENOR
        type: string
        description: "Swap tenor (1Y, 2Y, 3Y, 5Y, 7Y, 10Y, 15Y, 20Y, 30Y)"
        semantic_type: dimension
        example: "10Y"
        nullable: false
        primary_key: true

      - name: PAR_RATE
        type: float
        description: "Par swap rate (decimal)"
        semantic_type: measure
        example: "0.0385"
        nullable: false

      - name: SPREAD_VS_GOVT
        type: float
        description: "Spread versus government bond (bps)"
        semantic_type: measure
        example: "15.5"
        nullable: true

      - name: DV01
        type: float
        description: "Dollar value of 1bp move per $1M notional"
        semantic_type: measure
        example: "875.50"
        nullable: true

    use_cases:
      - "Yield curve construction"
      - "Derivative pricing and valuation"
      - "Duration hedging"
      - "Spread trading analysis"
      - "Risk-free rate determination"

    examples:
      - "rates.swap/USD/10Y/ALL - 10Y USD swap rate history"
      - "rates.swap/EUR/ALL/ALL - Full EUR swap curve"
      - "rates.swap/ALL/5Y/ALL - 5Y rates across currencies"

    related_monikers:
      - "govies.treasury - Treasury yields for spread calc"
      - "rates.sofr - SOFR rates for discounting"
      - "risk.cvar - Interest rate risk"

  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: RATES
      schema: SWAPS
      query: |
        SELECT asof_date, currency, tenor, par_rate, spread_vs_govt, dv01
        FROM SWAP_RATES
        WHERE ('{segments[0]}' = 'ALL' OR currency = '{segments[0]}')
          AND ('{segments[1]}' = 'ALL' OR tenor = '{segments[1]}')
        ORDER BY asof_date DESC, currency, tenor

rates.sofr:
  display_name: SOFR Rates
  description: Secured Overnight Financing Rate and term SOFR

  schema:
    description: |
      SOFR (Secured Overnight Financing Rate) - the primary USD risk-free rate.
      Includes overnight SOFR, term SOFR, and SOFR averages.

    semantic_tags:
      - sofr
      - risk-free-rate
      - overnight
      - benchmark
      - interest-rates

    granularity: "daily"
    typical_row_count: "1K-5K"
    update_frequency: "daily (T+1)"

    columns:
      - name: ASOF_DATE
        type: date
        description: "Rate date"
        semantic_type: timestamp
        example: "2026-01-28"

      - name: RATE_TYPE
        type: string
        description: "SOFR type (ON, 30D_AVG, 90D_AVG, TERM_1M, TERM_3M)"
        semantic_type: dimension
        example: "ON"

      - name: RATE
        type: float
        description: "Rate value (decimal)"
        semantic_type: measure
        example: "0.0430"

    use_cases:
      - "Loan and derivative pricing"
      - "Benchmark rate analysis"
      - "LIBOR transition"

    examples:
      - "rates.sofr/USD/ON/ALL - Overnight SOFR history"

  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: RATES
      schema: BENCHMARKS
      query: |
        SELECT asof_date, 'USD' as currency, rate_type, rate
        FROM SOFR_RATES
        WHERE ('{segments[1]}' = 'ALL' OR rate_type = '{segments[1]}')
        ORDER BY asof_date DESC


# =============================================================================
# MORTGAGES - Mortgage Data (Excel)
# =============================================================================

mortgages:
  display_name: Mortgage Analytics
  description: Mortgage-backed securities, prepayment data, and pool analytics
  ownership:
    accountable_owner: mbs-governance@firm.com
    data_specialist: mbs-research@firm.com
    support_channel: "#mortgage-data"
    adop: securitized-head@firm.com
    ads: mbs-data-steward@firm.com
    adal: mbs-access-control@firm.com
  classification: confidential

# Example monikers:
#   mortgages.pools/FNMA/30Y/ALL    - Fannie Mae 30Y pools
#   mortgages.prepay/GNMA/15Y/ALL   - Ginnie Mae 15Y prepayment data
mortgages.pools:
  display_name: MBS Pool Data
  description: Agency MBS pool characteristics and analytics from Excel models

  data_quality:
    dq_owner: mbs-dq@firm.com
    quality_score: 92.5
    validation_rules:
      - "WAC must be positive and reasonable"
      - "WAM must be less than original term"
      - "Pool factor must be between 0 and 1"
    known_issues:
      - "Some legacy pools have incomplete geographic data"
      - "Prepayment projections updated monthly"
    last_validated: "2026-01-27T12:00:00Z"

  sla:
    freshness: "Monthly (factor data), Daily (prices)"
    availability: "99.0%"
    support_hours: "Business hours ET"
    escalation_contact: mbs-research@firm.com

  freshness:
    last_loaded: "2026-01-15T08:00:00Z"
    refresh_schedule: "Monthly factor updates, daily price updates"
    source_system: "Internal MBS Analytics (Excel)"
    upstream_dependencies:
      - "reference.security"
      - "rates.swap"

  schema:
    description: |
      Agency mortgage-backed securities pool data from internal Excel models.
      Includes Fannie Mae (FNMA), Freddie Mac (FHLMC), and Ginnie Mae (GNMA) pools.
      Contains pool characteristics, prepayment projections, and OAS analytics.

    semantic_tags:
      - mortgages
      - mbs
      - agency
      - prepayment
      - securitization
      - fixed-income
      - fannie-mae
      - freddie-mac
      - ginnie-mae

    granularity: "monthly, per-agency, per-coupon"
    typical_row_count: "50K-200K"
    update_frequency: "monthly (factors), daily (prices)"

    primary_key:
      - ASOF_DATE
      - POOL_ID
      - AGENCY

    columns:
      - name: ASOF_DATE
        type: date
        description: "Data as-of date"
        semantic_type: timestamp
        example: "2026-01-15"
        nullable: false
        primary_key: true

      - name: POOL_ID
        type: string
        description: "Pool identifier (CUSIP or pool number)"
        semantic_type: identifier
        example: "31417EQ38"
        nullable: false
        primary_key: true
        foreign_key: "reference.security/CUSIP"

      - name: AGENCY
        type: string
        description: "Issuing agency (FNMA, FHLMC, GNMA)"
        semantic_type: dimension
        example: "FNMA"
        nullable: false
        primary_key: true

      - name: COUPON
        type: string
        description: "Pool coupon (e.g., 30Y, 15Y)"
        semantic_type: dimension
        example: "30Y"
        nullable: false

      - name: WAC
        type: float
        description: "Weighted average coupon (decimal)"
        semantic_type: measure
        example: "0.0425"
        nullable: false

      - name: WAM
        type: integer
        description: "Weighted average maturity (months)"
        semantic_type: measure
        example: "342"
        nullable: false

      - name: WALA
        type: integer
        description: "Weighted average loan age (months)"
        semantic_type: measure
        example: "18"
        nullable: false

      - name: POOL_FACTOR
        type: float
        description: "Current pool factor (remaining principal)"
        semantic_type: measure
        example: "0.9234"
        nullable: false

      - name: CPR_1M
        type: float
        description: "1-month conditional prepayment rate"
        semantic_type: measure
        example: "8.5"
        nullable: true

      - name: CPR_3M
        type: float
        description: "3-month conditional prepayment rate"
        semantic_type: measure
        example: "9.2"
        nullable: true

      - name: OAS
        type: float
        description: "Option-adjusted spread (bps)"
        semantic_type: measure
        example: "45.5"
        nullable: true

      - name: PRICE
        type: float
        description: "Current price (percentage of par)"
        semantic_type: measure
        example: "101.25"
        nullable: true

    use_cases:
      - "MBS portfolio analytics"
      - "Prepayment modeling"
      - "Relative value analysis"
      - "Duration and convexity calculations"
      - "Regulatory capital (GSE exposure)"

    examples:
      - "mortgages.pools/FNMA/30Y/ALL - All Fannie 30Y pools"
      - "mortgages.pools/ALL/ALL/31417EQ38 - Specific pool history"
      - "mortgages.pools/GNMA/15Y/ALL - Ginnie Mae 15Y pools"

    related_monikers:
      - "rates.swap - Swap rates for OAS calculation"
      - "govies.treasury - Treasury yields for spread"
      - "mortgages.prepay - Prepayment model outputs"

  source_binding:
    type: excel
    config:
      base_path: /data/mbs/pools
      file_pattern: "{segments[0]}_{segments[1]}_pools.xlsx"
      sheet: PoolData
      header_row: 2

mortgages.prepay:
  display_name: Prepayment Projections
  description: MBS prepayment model outputs and CPR projections

  schema:
    description: |
      Prepayment projections from internal MBS models.
      Includes CPR scenarios, S-curves, and turnover analysis.

    semantic_tags:
      - mortgages
      - prepayment
      - cpr
      - modeling
      - projections

    granularity: "monthly, per-pool"
    typical_row_count: "100K-500K"
    update_frequency: "monthly"

    columns:
      - name: ASOF_DATE
        type: date
        description: "Projection date"
        semantic_type: timestamp
        example: "2026-01-15"

      - name: POOL_ID
        type: string
        description: "Pool identifier"
        semantic_type: identifier
        example: "31417EQ38"

      - name: SCENARIO
        type: string
        description: "Rate scenario (BASE, UP100, DN100)"
        semantic_type: dimension
        example: "BASE"

      - name: CPR_PROJ
        type: float
        description: "Projected CPR for next 12 months"
        semantic_type: measure
        example: "12.5"

      - name: SMM
        type: float
        description: "Single monthly mortality rate"
        semantic_type: measure
        example: "1.05"

    use_cases:
      - "Prepayment scenario analysis"
      - "Cash flow projections"
      - "Duration hedging"

    examples:
      - "mortgages.prepay/FNMA/30Y/ALL - Fannie 30Y prepay projections"

  source_binding:
    type: excel
    config:
      base_path: /data/mbs/prepay
      file_pattern: "{segments[0]}_{segments[1]}_prepay.xlsx"
      sheet: Projections
      header_row: 1
