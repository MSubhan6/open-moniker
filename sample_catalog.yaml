# Moniker Catalog Definition
#
# Format: [namespace@]domain.subdomain/path/segments[@version][/vN]
#
# Each entry defines:
#   - ownership: Accountable owner, data specialist, support channel
#   - source_binding: How to fetch data (snowflake, oracle, rest, static, excel, opensearch, etc.)
#
# Ownership inherits down the hierarchy. Source bindings define leaf nodes.
#
# Query templates support placeholders:
#   {path}         - Full sub-path after the binding
#   {segments[N]}  - Specific path segment (0-indexed)
#   {version}      - Version from @suffix (e.g., @20260115, @latest)
#   {revision}     - Revision from /vN suffix
#   {namespace}    - Namespace prefix if provided


# =============================================================================
# INDICES - Benchmark indices and aggregates
# =============================================================================

indices:
  display_name: Market Indices
  description: Benchmark indices, aggregates, and composites
  ownership:
    accountable_owner: indices-governance@firm.com
    data_specialist: quant-research@firm.com
    support_channel: "#indices-support"

indices.sovereign:
  display_name: Sovereign Indices
  description: Government bond indices by region and currency

# Example: indices.sovereign/developed/EU.GovBondAgg/EUR/ALL
# Using {filter[N]:col} for ALL support and {version_date} for date handling
indices.sovereign/developed:
  display_name: Developed Markets Sovereign
  description: DM government bond benchmarks
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: ANALYTICS_WH
      database: INDICES
      schema: SOVEREIGN
      query: |
        SELECT index_id, index_name, currency, weight, yield, duration, mod_duration
        FROM DM_SOVEREIGN_INDICES
        WHERE {filter[0]:index_family}
          AND {filter[1]:currency}
          AND as_of_date = {version_date}

indices.corporate:
  display_name: Corporate Indices
  description: Investment grade and high yield corporate bond indices
  ownership:
    data_specialist: credit-research@firm.com

indices.corporate/ig:
  display_name: Investment Grade Corporate
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: ANALYTICS_WH
      database: INDICES
      schema: CORPORATE
      query: |
        SELECT index_id, sector, rating_bucket, spread, oas, duration
        FROM IG_CORPORATE_INDICES
        WHERE sector = '{segments[0]}'


# =============================================================================
# COMMODITIES - Futures, spot, and derivatives
# =============================================================================

commodities:
  display_name: Commodities
  description: Commodity futures, spot prices, and derivatives
  ownership:
    accountable_owner: commodities-desk@firm.com
    data_specialist: commodities-quant@firm.com
    support_channel: "#commodities-data"

commodities.derivatives:
  display_name: Commodity Derivatives
  description: Futures and options on commodities

# Example: commodities.derivatives/energy/ALL
commodities.derivatives/energy:
  display_name: Energy Derivatives
  description: Crude, natural gas, power futures
  source_binding:
    type: rest
    config:
      base_url: https://market-data.internal.firm.com
      path_template: /api/v2/commodities/energy/{path}
      method: GET
      auth_type: bearer
      headers:
        Accept: application/json
      response_format: json

commodities.derivatives/metals:
  display_name: Precious Metals
  source_binding:
    type: rest
    config:
      base_url: https://market-data.internal.firm.com
      path_template: /api/v2/commodities/metals/{path}
      method: GET
      auth_type: bearer

# Example: commodities.derivatives/crypto/ETH@20260115/v2
commodities.derivatives/crypto:
  display_name: Digital Assets
  description: Cryptocurrency spot and derivatives
  ownership:
    data_specialist: digital-assets@firm.com
  source_binding:
    type: rest
    config:
      base_url: https://crypto-data.internal.firm.com
      path_template: /api/v3/assets/{segments[0]}
      method: GET
      auth_type: api_key
      # Supports versioning: @20260115 becomes as_of query param
      query_params:
        as_of: "{version}"
        schema_version: "{revision}"


# =============================================================================
# REFERENCE - Security master, calendars, static data
# =============================================================================

reference:
  display_name: Reference Data
  description: Security master, calendars, and static reference data
  ownership:
    accountable_owner: ref-data-governance@firm.com
    data_specialist: ref-data-ops@firm.com
    support_channel: "#reference-data"
  classification: internal

reference.security:
  display_name: Security Master
  description: Canonical security identifiers and attributes

# Example: verified@reference.security/ISIN/US0378331005@latest
# The "verified" namespace indicates official/golden source
reference.security/ISIN:
  display_name: ISIN Lookup
  description: International Securities Identification Numbers
  source_binding:
    type: oracle
    config:
      dsn: secmaster.firm.com:1521/SECMASTER
      query: |
        SELECT isin, cusip, sedol, ticker, issuer_name,
               country_code, currency, security_type, active_flag
        FROM SECURITY_MASTER
        WHERE isin = '{segments[0]}'
          AND effective_date = NVL(TO_DATE('{version}', 'YYYYMMDD'), TRUNC(SYSDATE))

reference.security/CUSIP:
  display_name: CUSIP Lookup
  source_binding:
    type: oracle
    config:
      dsn: secmaster.firm.com:1521/SECMASTER
      query: |
        SELECT isin, cusip, sedol, ticker, issuer_name,
               country_code, currency, security_type, active_flag
        FROM SECURITY_MASTER
        WHERE cusip = '{segments[0]}'

reference.security/SEDOL:
  display_name: SEDOL Lookup
  source_binding:
    type: oracle
    config:
      dsn: secmaster.firm.com:1521/SECMASTER
      query: |
        SELECT isin, cusip, sedol, ticker, issuer_name,
               country_code, currency, security_type, active_flag
        FROM SECURITY_MASTER
        WHERE sedol = '{segments[0]}'

reference.calendars:
  display_name: Trading Calendars
  description: Exchange and settlement calendars

reference.calendars/exchange:
  display_name: Exchange Calendars
  source_binding:
    type: static
    config:
      base_path: /data/reference/calendars/exchange
      file_pattern: "{segments[0]}.json"
      format: json

reference.calendars/settlement:
  display_name: Settlement Calendars
  source_binding:
    type: static
    config:
      base_path: /data/reference/calendars/settlement
      file_pattern: "{segments[0]}.csv"
      format: csv


# =============================================================================
# INSTRUMENTS - Detailed security attributes
# =============================================================================

instruments:
  display_name: Instrument Details
  description: Detailed security attributes and terms
  ownership:
    accountable_owner: ref-data-governance@firm.com
    data_specialist: security-ops@firm.com
    support_channel: "#instruments"

# Example: instruments/US0378331005/metadata
instruments/metadata:
  display_name: Instrument Metadata
  description: Security terms, attributes, and classifications
  source_binding:
    type: opensearch
    config:
      hosts:
        - https://search.internal.firm.com:9200
      index: instruments-v2
      query: |
        {
          "query": {
            "bool": {
              "must": [
                {"term": {"security_id": "{segments[0]}"}}
              ]
            }
          }
        }


# =============================================================================
# ANALYTICS - Risk, attribution, and calculated metrics
# =============================================================================

analytics:
  display_name: Analytics
  description: Risk metrics, attribution, and calculated analytics
  ownership:
    accountable_owner: risk-governance@firm.com
    data_specialist: quant-analytics@firm.com
    support_channel: "#analytics-support"
  classification: confidential

analytics.risk:
  display_name: Risk Analytics
  description: VaR, stress tests, sensitivities

analytics.risk/var:
  display_name: Value at Risk
  source_binding:
    type: rest
    config:
      base_url: https://risk-engine.internal.firm.com
      path_template: /api/v2/var/{path}
      method: GET
      auth_type: bearer

analytics.risk/stress:
  display_name: Stress Testing
  source_binding:
    type: rest
    config:
      base_url: https://risk-engine.internal.firm.com
      path_template: /api/v2/stress/{path}
      method: GET
      auth_type: bearer

# Example: user@analytics.risk/views/my-watchlist@20260115/v3
# User-scoped views require namespace prefix
analytics.risk/views:
  display_name: User Risk Views
  description: Saved user views and filters (namespace required)
  source_binding:
    type: rest
    config:
      base_url: https://risk-engine.internal.firm.com
      path_template: /api/v2/views/{namespace}/{segments[0]}
      method: GET
      auth_type: bearer
      query_params:
        as_of: "{version}"
        version: "{revision}"


# =============================================================================
# HOLDINGS - Portfolio positions and exposures
# =============================================================================

holdings:
  display_name: Holdings & Positions
  description: Portfolio positions, exposures, and allocations
  ownership:
    accountable_owner: portfolio-ops@firm.com
    data_specialist: position-management@firm.com
    support_channel: "#positions"
  classification: confidential

# Example: holdings/20260115/fund_alpha
holdings/positions:
  display_name: Position Data
  description: End of day positions by date and portfolio
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: POSITIONS_WH
      database: HOLDINGS
      schema: POSITIONS
      query: |
        SELECT portfolio_id, security_id, quantity, market_value,
               cost_basis, unrealized_pnl, currency
        FROM DAILY_POSITIONS
        WHERE as_of_date = TO_DATE('{segments[0]}', 'YYYYMMDD')
          AND portfolio_id = '{segments[1]}'

holdings/exposures:
  display_name: Exposure Analysis
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: ANALYTICS_WH
      database: HOLDINGS
      schema: ANALYTICS
      query: |
        SELECT portfolio_id, dimension, bucket, exposure_pct, notional
        FROM EXPOSURE_BREAKDOWN
        WHERE as_of_date = TO_DATE('{segments[0]}', 'YYYYMMDD')
          AND portfolio_id = '{segments[1]}'


# =============================================================================
# REPORTS - Generated reports and exports
# =============================================================================

reports:
  display_name: Reports
  description: Generated reports, exports, and documents
  ownership:
    accountable_owner: reporting-ops@firm.com
    data_specialist: report-dev@firm.com
    support_channel: "#reporting"

reports/daily:
  display_name: Daily Reports
  source_binding:
    type: static
    config:
      base_path: /data/reports/daily
      file_pattern: "{segments[0]}/{segments[1]}.pdf"
      format: binary

reports/regulatory:
  display_name: Regulatory Reports
  classification: restricted
  source_binding:
    type: excel
    config:
      base_path: /data/reports/regulatory
      file_pattern: "{segments[0]}/{segments[1]}.xlsx"
      sheet: Summary


# =============================================================================
# PRICES - Real-time and historical prices
# =============================================================================

prices:
  display_name: Market Prices
  description: Real-time and historical security prices
  ownership:
    accountable_owner: market-data-governance@firm.com
    data_specialist: market-data-ops@firm.com
    support_channel: "#market-data"

# Example: prices.equity/AAPL@20260115 or prices.equity/ALL@latest
prices.equity:
  display_name: Equity Prices
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: PRICES
      schema: EQUITY
      query: |
        SELECT symbol, open_price, high_price, low_price, close_price, volume, vwap
        FROM EQUITY_EOD
        WHERE {filter[0]:symbol}
          AND trade_date = CASE
            WHEN {is_latest} = 'true' THEN (SELECT MAX(trade_date) FROM EQUITY_EOD)
            ELSE {version_date}
          END

prices.fx:
  display_name: FX Rates
  source_binding:
    type: rest
    config:
      base_url: https://fx-service.internal.firm.com
      path_template: /api/v1/rates/{segments[0]}/{segments[1]}
      method: GET
      auth_type: bearer

prices.fixed-income:
  display_name: Fixed Income Prices
  source_binding:
    type: snowflake
    config:
      account: firm-prod.us-east-1
      warehouse: MARKET_DATA_WH
      database: PRICES
      schema: FIXED_INCOME
      query: |
        SELECT security_id, bid_price, ask_price, mid_price, yield_to_maturity, spread
        FROM BOND_PRICES
        WHERE security_id = '{segments[0]}'
