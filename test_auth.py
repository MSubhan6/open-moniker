#!/usr/bin/env python3
"""Quick auth test script."""

import sys
sys.path.insert(0, "client")

from moniker_client import MonikerClient, ClientConfig

TOKEN = "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImRYR0pMV3JVX0dsQk9hdTJUX2taYSJ9.eyJpc3MiOiJodHRwczovL2Rldi03ajhlbGxsaW50MjJzcTdoLnVrLmF1dGgwLmNvbS8iLCJzdWIiOiJzOVg5QXJ6bTV3ZnNVb0NRbmlvTlUxU1A4eG1hbjBNNUBjbGllbnRzIiwiYXVkIjoiaHR0cHM6Ly9kZXYtN2o4ZWxsbGludDIyc3E3aC51ay5hdXRoMC5jb20vYXBpL3YyLyIsImlhdCI6MTc2OTIwOTY5MywiZXhwIjoxNzY5Mjk2MDkzLCJzY29wZSI6InJlYWQ6Y2xpZW50X2dyYW50cyBjcmVhdGU6Y2xpZW50X2dyYW50cyBkZWxldGU6Y2xpZW50X2dyYW50cyB1cGRhdGU6Y2xpZW50X2dyYW50cyByZWFkOnVzZXJzIHVwZGF0ZTp1c2VycyBkZWxldGU6dXNlcnMgY3JlYXRlOnVzZXJzIHJlYWQ6dXNlcnNfYXBwX21ldGFkYXRhIHVwZGF0ZTp1c2Vyc19hcHBfbWV0YWRhdGEgZGVsZXRlOnVzZXJzX2FwcF9tZXRhZGF0YSBjcmVhdGU6dXNlcnNfYXBwX21ldGFkYXRhIHJlYWQ6dXNlcl9jdXN0b21fYmxvY2tzIGNyZWF0ZTp1c2VyX2N1c3RvbV9ibG9ja3MgZGVsZXRlOnVzZXJfY3VzdG9tX2Jsb2NrcyBjcmVhdGU6dXNlcl90aWNrZXRzIHJlYWQ6Y2xpZW50cyB1cGRhdGU6Y2xpZW50cyBkZWxldGU6Y2xpZW50cyBjcmVhdGU6Y2xpZW50cyByZWFkOmNsaWVudF9rZXlzIHVwZGF0ZTpjbGllbnRfa2V5cyBkZWxldGU6Y2xpZW50X2tleXMgY3JlYXRlOmNsaWVudF9rZXlzIHJlYWQ6Y2xpZW50X2NyZWRlbnRpYWxzIHVwZGF0ZTpjbGllbnRfY3JlZGVudGlhbHMgZGVsZXRlOmNsaWVudF9jcmVkZW50aWFscyBjcmVhdGU6Y2xpZW50X2NyZWRlbnRpYWxzIHJlYWQ6Y29ubmVjdGlvbnMgdXBkYXRlOmNvbm5lY3Rpb25zIGRlbGV0ZTpjb25uZWN0aW9ucyBjcmVhdGU6Y29ubmVjdGlvbnMgcmVhZDpyZXNvdXJjZV9zZXJ2ZXJzIHVwZGF0ZTpyZXNvdXJjZV9zZXJ2ZXJzIGRlbGV0ZTpyZXNvdXJjZV9zZXJ2ZXJzIGNyZWF0ZTpyZXNvdXJjZV9zZXJ2ZXJzIHJlYWQ6ZGV2aWNlX2NyZWRlbnRpYWxzIHVwZGF0ZTpkZXZpY2VfY3JlZGVudGlhbHMgZGVsZXRlOmRldmljZV9jcmVkZW50aWFscyBjcmVhdGU6ZGV2aWNlX2NyZWRlbnRpYWxzIHJlYWQ6cnVsZXMgdXBkYXRlOnJ1bGVzIGRlbGV0ZTpydWxlcyBjcmVhdGU6cnVsZXMgcmVhZDpydWxlc19jb25maWdzIHVwZGF0ZTpydWxlc19jb25maWdzIGRlbGV0ZTpydWxlc19jb25maWdzIHJlYWQ6aG9va3MgdXBkYXRlOmhvb2tzIGRlbGV0ZTpob29rcyBjcmVhdGU6aG9va3MgcmVhZDphY3Rpb25zIHVwZGF0ZTphY3Rpb25zIGRlbGV0ZTphY3Rpb25zIGNyZWF0ZTphY3Rpb25zIHJlYWQ6ZW1haWxfcHJvdmlkZXIgdXBkYXRlOmVtYWlsX3Byb3ZpZGVyIGRlbGV0ZTplbWFpbF9wcm92aWRlciBjcmVhdGU6ZW1haWxfcHJvdmlkZXIgYmxhY2tsaXN0OnRva2VucyByZWFkOnN0YXRzIHJlYWQ6aW5zaWdodHMgcmVhZDp0ZW5hbnRfc2V0dGluZ3MgdXBkYXRlOnRlbmFudF9zZXR0aW5ncyByZWFkOmxvZ3MgcmVhZDpsb2dzX3VzZXJzIHJlYWQ6c2hpZWxkcyBjcmVhdGU6c2hpZWxkcyB1cGRhdGU6c2hpZWxkcyBkZWxldGU6c2hpZWxkcyByZWFkOmFub21hbHlfYmxvY2tzIGRlbGV0ZTphbm9tYWx5X2Jsb2NrcyB1cGRhdGU6dHJpZ2dlcnMgcmVhZDp0cmlnZ2VycyByZWFkOmdyYW50cyBkZWxldGU6Z3JhbnRzIHJlYWQ6Z3VhcmRpYW5fZmFjdG9ycyB1cGRhdGU6Z3VhcmRpYW5fZmFjdG9ycyByZWFkOmd1YXJkaWFuX2Vucm9sbG1lbnRzIGRlbGV0ZTpndWFyZGlhbl9lbnJvbGxtZW50cyBjcmVhdGU6Z3VhcmRpYW5fZW5yb2xsbWVudF90aWNrZXRzIHJlYWQ6dXNlcl9pZHBfdG9rZW5zIGNyZWF0ZTpwYXNzd29yZHNfY2hlY2tpbmdfam9iIGRlbGV0ZTpwYXNzd29yZHNfY2hlY2tpbmdfam9iIHJlYWQ6Y3VzdG9tX2RvbWFpbnMgZGVsZXRlOmN1c3RvbV9kb21haW5zIGNyZWF0ZTpjdXN0b21fZG9tYWlucyB1cGRhdGU6Y3VzdG9tX2RvbWFpbnMgcmVhZDplbWFpbF90ZW1wbGF0ZXMgY3JlYXRlOmVtYWlsX3RlbXBsYXRlcyB1cGRhdGU6ZW1haWxfdGVtcGxhdGVzIHJlYWQ6bWZhX3BvbGljaWVzIHVwZGF0ZTptZmFfcG9saWNpZXMgcmVhZDpyb2xlcyBjcmVhdGU6cm9sZXMgZGVsZXRlOnJvbGVzIHVwZGF0ZTpyb2xlcyByZWFkOnByb21wdHMgdXBkYXRlOnByb21wdHMgcmVhZDpicmFuZGluZyB1cGRhdGU6YnJhbmRpbmcgZGVsZXRlOmJyYW5kaW5nIHJlYWQ6bG9nX3N0cmVhbXMgY3JlYXRlOmxvZ19zdHJlYW1zIGRlbGV0ZTpsb2dfc3RyZWFtcyB1cGRhdGU6bG9nX3N0cmVhbXMgY3JlYXRlOnNpZ25pbmdfa2V5cyByZWFkOnNpZ25pbmdfa2V5cyB1cGRhdGU6c2lnbmluZ19rZXlzIHJlYWQ6bGltaXRzIHVwZGF0ZTpsaW1pdHMgY3JlYXRlOnJvbGVfbWVtYmVycyByZWFkOnJvbGVfbWVtYmVycyBkZWxldGU6cm9sZV9tZW1iZXJzIHJlYWQ6ZW50aXRsZW1lbnRzIHJlYWQ6YXR0YWNrX3Byb3RlY3Rpb24gdXBkYXRlOmF0dGFja19wcm90ZWN0aW9uIHJlYWQ6b3JnYW5pemF0aW9uc19zdW1tYXJ5IGNyZWF0ZTphdXRoZW50aWNhdGlvbl9tZXRob2RzIHJlYWQ6YXV0aGVudGljYXRpb25fbWV0aG9kcyB1cGRhdGU6YXV0aGVudGljYXRpb25fbWV0aG9kcyBkZWxldGU6YXV0aGVudGljYXRpb25fbWV0aG9kcyByZWFkOm9yZ2FuaXphdGlvbnMgdXBkYXRlOm9yZ2FuaXphdGlvbnMgY3JlYXRlOm9yZ2FuaXphdGlvbnMgZGVsZXRlOm9yZ2FuaXphdGlvbnMgcmVhZDpvcmdhbml6YXRpb25fZGlzY292ZXJ5X2RvbWFpbnMgdXBkYXRlOm9yZ2FuaXphdGlvbl9kaXNjb3ZlcnlfZG9tYWlucyBjcmVhdGU6b3JnYW5pemF0aW9uX2Rpc2NvdmVyeV9kb21haW5zIGRlbGV0ZTpvcmdhbml6YXRpb25fZGlzY292ZXJ5X2RvbWFpbnMgY3JlYXRlOm9yZ2FuaXphdGlvbl9tZW1iZXJzIHJlYWQ6b3JnYW5pemF0aW9uX21lbWJlcnMgZGVsZXRlOm9yZ2FuaXphdGlvbl9tZW1iZXJzIGNyZWF0ZTpvcmdhbml6YXRpb25fY29ubmVjdGlvbnMgcmVhZDpvcmdhbml6YXRpb25fY29ubmVjdGlvbnMgdXBkYXRlOm9yZ2FuaXphdGlvbl9jb25uZWN0aW9ucyBkZWxldGU6b3JnYW5pemF0aW9uX2Nvbm5lY3Rpb25zIGNyZWF0ZTpvcmdhbml6YXRpb25fbWVtYmVyX3JvbGVzIHJlYWQ6b3JnYW5pemF0aW9uX21lbWJlcl9yb2xlcyBkZWxldGU6b3JnYW5pemF0aW9uX21lbWJlcl9yb2xlcyBjcmVhdGU6b3JnYW5pemF0aW9uX2ludml0YXRpb25zIHJlYWQ6b3JnYW5pemF0aW9uX2ludml0YXRpb25zIGRlbGV0ZTpvcmdhbml6YXRpb25faW52aXRhdGlvbnMgcmVhZDpzY2ltX2NvbmZpZyBjcmVhdGU6c2NpbV9jb25maWcgdXBkYXRlOnNjaW1fY29uZmlnIGRlbGV0ZTpzY2ltX2NvbmZpZyBjcmVhdGU6c2NpbV90b2tlbiByZWFkOnNjaW1fdG9rZW4gZGVsZXRlOnNjaW1fdG9rZW4gZGVsZXRlOnBob25lX3Byb3ZpZGVycyBjcmVhdGU6cGhvbmVfcHJvdmlkZXJzIHJlYWQ6cGhvbmVfcHJvdmlkZXJzIHVwZGF0ZTpwaG9uZV9wcm92aWRlcnMgZGVsZXRlOnBob25lX3RlbXBsYXRlcyBjcmVhdGU6cGhvbmVfdGVtcGxhdGVzIHJlYWQ6cGhvbmVfdGVtcGxhdGVzIHVwZGF0ZTpwaG9uZV90ZW1wbGF0ZXMgY3JlYXRlOmVuY3J5cHRpb25fa2V5cyByZWFkOmVuY3J5cHRpb25fa2V5cyB1cGRhdGU6ZW5jcnlwdGlvbl9rZXlzIGRlbGV0ZTplbmNyeXB0aW9uX2tleXMgcmVhZDpzZXNzaW9ucyB1cGRhdGU6c2Vzc2lvbnMgZGVsZXRlOnNlc3Npb25zIHJlYWQ6cmVmcmVzaF90b2tlbnMgdXBkYXRlOnJlZnJlc2hfdG9rZW5zIGRlbGV0ZTpyZWZyZXNoX3Rva2VucyBjcmVhdGU6c2VsZl9zZXJ2aWNlX3Byb2ZpbGVzIHJlYWQ6c2VsZl9zZXJ2aWNlX3Byb2ZpbGVzIHVwZGF0ZTpzZWxmX3NlcnZpY2VfcHJvZmlsZXMgZGVsZXRlOnNlbGZfc2VydmljZV9wcm9maWxlcyBjcmVhdGU6c3NvX2FjY2Vzc190aWNrZXRzIGRlbGV0ZTpzc29fYWNjZXNzX3RpY2tldHMgcmVhZDpmb3JtcyB1cGRhdGU6Zm9ybXMgZGVsZXRlOmZvcm1zIGNyZWF0ZTpmb3JtcyByZWFkOmZsb3dzIHVwZGF0ZTpmbG93cyBkZWxldGU6Zmxvd3MgY3JlYXRlOmZsb3dzIHJlYWQ6Zmxvd3NfdmF1bHQgcmVhZDpmbG93c192YXVsdF9jb25uZWN0aW9ucyB1cGRhdGU6Zmxvd3NfdmF1bHRfY29ubmVjdGlvbnMgZGVsZXRlOmZsb3dzX3ZhdWx0X2Nvbm5lY3Rpb25zIGNyZWF0ZTpmbG93c192YXVsdF9jb25uZWN0aW9ucyByZWFkOmZsb3dzX2V4ZWN1dGlvbnMgZGVsZXRlOmZsb3dzX2V4ZWN1dGlvbnMgcmVhZDpjb25uZWN0aW9uc19vcHRpb25zIHVwZGF0ZTpjb25uZWN0aW9uc19vcHRpb25zIHJlYWQ6c2VsZl9zZXJ2aWNlX3Byb2ZpbGVfY3VzdG9tX3RleHRzIHVwZGF0ZTpzZWxmX3NlcnZpY2VfcHJvZmlsZV9jdXN0b21fdGV4dHMgY3JlYXRlOm5ldHdvcmtfYWNscyB1cGRhdGU6bmV0d29ya19hY2xzIHJlYWQ6bmV0d29ya19hY2xzIGRlbGV0ZTpuZXR3b3JrX2FjbHMgZGVsZXRlOnZkY3NfdGVtcGxhdGVzIHJlYWQ6dmRjc190ZW1wbGF0ZXMgY3JlYXRlOnZkY3NfdGVtcGxhdGVzIHVwZGF0ZTp2ZGNzX3RlbXBsYXRlcyBjcmVhdGU6Y3VzdG9tX3NpZ25pbmdfa2V5cyByZWFkOmN1c3RvbV9zaWduaW5nX2tleXMgdXBkYXRlOmN1c3RvbV9zaWduaW5nX2tleXMgZGVsZXRlOmN1c3RvbV9zaWduaW5nX2tleXMgcmVhZDpmZWRlcmF0ZWRfY29ubmVjdGlvbnNfdG9rZW5zIGRlbGV0ZTpmZWRlcmF0ZWRfY29ubmVjdGlvbnNfdG9rZW5zIGNyZWF0ZTp1c2VyX2F0dHJpYnV0ZV9wcm9maWxlcyByZWFkOnVzZXJfYXR0cmlidXRlX3Byb2ZpbGVzIHVwZGF0ZTp1c2VyX2F0dHJpYnV0ZV9wcm9maWxlcyBkZWxldGU6dXNlcl9hdHRyaWJ1dGVfcHJvZmlsZXMgcmVhZDpldmVudF9zdHJlYW1zIGNyZWF0ZTpldmVudF9zdHJlYW1zIGRlbGV0ZTpldmVudF9zdHJlYW1zIHVwZGF0ZTpldmVudF9zdHJlYW1zIHJlYWQ6ZXZlbnRfZGVsaXZlcmllcyB1cGRhdGU6ZXZlbnRfZGVsaXZlcmllcyBjcmVhdGU6Y29ubmVjdGlvbl9wcm9maWxlcyByZWFkOmNvbm5lY3Rpb25fcHJvZmlsZXMgdXBkYXRlOmNvbm5lY3Rpb25fcHJvZmlsZXMgZGVsZXRlOmNvbm5lY3Rpb25fcHJvZmlsZXMgY3JlYXRlOmdyb3VwX3JvbGVzIGRlbGV0ZTpncm91cF9yb2xlcyByZWFkOnVzZXJfZWZmZWN0aXZlX3Blcm1pc3Npb25zIHJlYWQ6dXNlcl9lZmZlY3RpdmVfcm9sZXMgcmVhZDpvcmdhbml6YXRpb25fbWVtYmVyX2VmZmVjdGl2ZV9yb2xlcyByZWFkOnVzZXJfcm9sZV9zb3VyY2VfZ3JvdXBzIHJlYWQ6b3JnYW5pemF0aW9uX21lbWJlcl9yb2xlX3NvdXJjZV9ncm91cHMgcmVhZDp1c2VyX3Blcm1pc3Npb25fc291cmNlX3JvbGVzIHJlYWQ6Z3JvdXBfcm9sZXMgcmVhZDpvcmdhbml6YXRpb25fZ3JvdXBzIGNyZWF0ZTpvcmdhbml6YXRpb25fZ3JvdXBzIGRlbGV0ZTpvcmdhbml6YXRpb25fZ3JvdXBzIHJlYWQ6b3JnYW5pemF0aW9uX2dyb3VwX3JvbGVzIGNyZWF0ZTpvcmdhbml6YXRpb25fZ3JvdXBfcm9sZXMgZGVsZXRlOm9yZ2FuaXphdGlvbl9ncm91cF9yb2xlcyBjcmVhdGU6dG9rZW5fZXhjaGFuZ2VfcHJvZmlsZXMgcmVhZDp0b2tlbl9leGNoYW5nZV9wcm9maWxlcyB1cGRhdGU6dG9rZW5fZXhjaGFuZ2VfcHJvZmlsZXMgZGVsZXRlOnRva2VuX2V4Y2hhbmdlX3Byb2ZpbGVzIHJlYWQ6b3JnYW5pemF0aW9uX2NsaWVudF9ncmFudHMgY3JlYXRlOm9yZ2FuaXphdGlvbl9jbGllbnRfZ3JhbnRzIGRlbGV0ZTpvcmdhbml6YXRpb25fY2xpZW50X2dyYW50cyByZWFkOmNvbm5lY3Rpb25zX2tleXMgdXBkYXRlOmNvbm5lY3Rpb25zX2tleXMgY3JlYXRlOmNvbm5lY3Rpb25zX2tleXMiLCJndHkiOiJjbGllbnQtY3JlZGVudGlhbHMiLCJhenAiOiJzOVg5QXJ6bTV3ZnNVb0NRbmlvTlUxU1A4eG1hbjBNNSJ9.AoMEIIP6KtJNzCqoaFBrzktwJ10pj7Fj8CHcEcuksXYol46YJLPPjgKi31yh0AWzPYJ2otNW_BuSqgwrkbM-mgqMzrvpDBt-Cb0k2j64Ajw-ntSKFV75eUMeb2zE2MvigKJapCIOEy4K1qz1k49SYjQtou49HlsNMoEJkwbluX9eLBoN_zn5tKiQ59JVrbqBwh1fcRh_QfabfUvpmBBaK0yAaLxGexTwtwyB7W5-ogcoHLS__3ZVzXunXzLZ9XdVtWcuyz_MXPW8PeFnlI7rvHUXVL-G145OkgW3VB7l7ZnZiZzt1FlUl25K_p9B-nMisgE22Rv8F18s8RjYt_rQQA"

print("=" * 60)
print("Testing Moniker Auth")
print("=" * 60)

# Test 1: With JWT auth
print("\n[1] Testing with JWT token...")
config = ClientConfig(
    service_url="http://localhost:8050",
    auth_method="jwt",
    jwt_token=TOKEN,
)
client = MonikerClient(config=config)

try:
    children = client.list_children()
    print(f"    SUCCESS! Got {len(children)} top-level paths: {children[:5]}...")
except Exception as e:
    print(f"    FAILED: {e}")

# Test 2: Without auth (anonymous - should work since enforce=false)
print("\n[2] Testing anonymous (no auth)...")
anon_client = MonikerClient()

try:
    children = anon_client.list_children()
    print(f"    SUCCESS! Got {len(children)} top-level paths: {children[:5]}...")
except Exception as e:
    print(f"    FAILED: {e}")

# Test 3: Check headers are being sent
print("\n[3] Checking auth headers...")
headers = client._get_headers()
if "Authorization" in headers:
    auth_header = headers["Authorization"]
    print(f"    Authorization header present: {auth_header[:50]}...")
else:
    print("    WARNING: No Authorization header!")

print("\n" + "=" * 60)
print("Done!")
