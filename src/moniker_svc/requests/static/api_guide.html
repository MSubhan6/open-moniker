<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moniker Request API — Developer Guide</title>
    <style>
        :root {
            --font-sans: Arial, Helvetica, sans-serif;
            --font-mono: 'Consolas', 'Monaco', 'Courier New', monospace;
            --c-navy: #022D5E;
            --c-gray: #53565A;
            --c-peacock: #005587;
            --c-green: #009639;
            --c-red: #D0002B;
            --c-yellow: #F2A900;
            --c-wine: #6D2077;
            --color-bg: #f8f9fa;
            --color-surface: #ffffff;
            --color-text: #111111;
            --border: rgba(83, 86, 90, 0.25);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--font-sans);
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: var(--c-navy);
            padding: 16px 24px;
            border-bottom: 3px solid var(--c-peacock);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 { font-size: 18px; font-weight: 700; color: white; }
        .header-nav a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-size: 13px;
            margin-left: 16px;
        }
        .header-nav a:hover { color: white; }

        /* Layout */
        .page { display: flex; max-width: 1200px; margin: 0 auto; }

        /* Sidebar TOC */
        .sidebar {
            width: 220px;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            padding: 24px 16px;
            border-right: 1px solid var(--border);
            background: var(--color-surface);
            flex-shrink: 0;
        }
        .sidebar h3 {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--c-gray);
            margin-bottom: 12px;
        }
        .sidebar a {
            display: block;
            font-size: 13px;
            color: var(--c-navy);
            text-decoration: none;
            padding: 5px 8px;
            border-radius: 4px;
            margin-bottom: 2px;
        }
        .sidebar a:hover { background: rgba(0, 85, 135, 0.06); }
        .sidebar a.active { background: rgba(0, 85, 135, 0.1); font-weight: 700; color: var(--c-peacock); }
        .sidebar .sep {
            border-top: 1px solid var(--border);
            margin: 10px 0;
        }

        /* Content */
        .content {
            flex: 1;
            padding: 32px 40px 80px;
            min-width: 0;
        }
        .content h2 {
            font-size: 22px;
            color: var(--c-navy);
            margin: 40px 0 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--c-peacock);
        }
        .content h2:first-child { margin-top: 0; }
        .content h3 {
            font-size: 15px;
            color: var(--c-navy);
            margin: 28px 0 8px;
        }
        .content p {
            font-size: 14px;
            color: #333;
            margin-bottom: 12px;
        }
        .content ul, .content ol {
            font-size: 14px;
            margin: 0 0 12px 20px;
            color: #333;
        }
        .content li { margin-bottom: 4px; }

        /* Inline code */
        code {
            font-family: var(--font-mono);
            font-size: 12px;
            background: rgba(0, 85, 135, 0.07);
            padding: 1px 5px;
            border-radius: 3px;
            color: var(--c-peacock);
        }

        /* Code blocks */
        .code-block {
            position: relative;
            margin: 12px 0 16px;
        }
        .code-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            padding: 6px 14px;
            background: #181825;
            color: #a6adc8;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .copy-btn {
            background: rgba(255,255,255,0.08);
            border: none;
            color: #a6adc8;
            font-size: 11px;
            font-family: var(--font-sans);
            padding: 2px 8px;
            border-radius: 3px;
            cursor: pointer;
        }
        .copy-btn:hover { background: rgba(255,255,255,0.15); color: white; }
        pre {
            background: #1e1e2e;
            color: #cdd6f4;
            padding: 16px 18px;
            border-radius: 0 0 6px 6px;
            font-family: var(--font-mono);
            font-size: 13px;
            line-height: 1.55;
            overflow-x: auto;
            margin: 0;
        }
        pre .cmt { color: #6c7086; font-style: italic; }
        pre .kw  { color: #cba6f7; }
        pre .fn  { color: #89b4fa; }
        pre .str { color: #a6e3a1; }
        pre .num { color: #fab387; }
        pre .key { color: #f9e2af; }
        pre .op  { color: #89dceb; }
        pre .prop { color: #89b4fa; }

        /* Language tabs */
        .lang-tabs {
            display: flex;
            gap: 0;
            margin: 12px 0 0;
        }
        .lang-tab {
            padding: 6px 16px;
            font-size: 12px;
            font-weight: 700;
            color: #a6adc8;
            background: #11111b;
            border: none;
            cursor: pointer;
            font-family: var(--font-sans);
            border-radius: 6px 6px 0 0;
            opacity: 0.6;
            transition: opacity 0.15s;
        }
        .lang-tab:hover { opacity: 0.8; }
        .lang-tab.active { opacity: 1; background: #181825; }
        .lang-panel { display: none; }
        .lang-panel.active { display: block; }
        .lang-panel .code-block { margin-top: 0; }
        .lang-panel .code-label { border-radius: 0; }
        .lang-panel:first-of-type .code-label { border-radius: 0; }

        /* Step markers */
        .step {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            margin: 24px 0 8px;
        }
        .step-num {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            background: var(--c-peacock);
            color: white;
            font-size: 14px;
            font-weight: 700;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .step-text {
            padding-top: 4px;
        }
        .step-text h3 {
            margin: 0 0 4px;
            font-size: 15px;
            color: var(--c-navy);
        }
        .step-text p {
            margin: 0;
            font-size: 13px;
            color: var(--c-gray);
        }

        /* Callouts */
        .callout {
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 13px;
            margin: 16px 0;
            line-height: 1.5;
        }
        .callout.info {
            background: rgba(0, 85, 135, 0.06);
            border-left: 3px solid var(--c-peacock);
        }
        .callout.warn {
            background: rgba(242, 169, 0, 0.08);
            border-left: 3px solid var(--c-yellow);
        }
        .callout.success {
            background: rgba(0, 150, 57, 0.06);
            border-left: 3px solid var(--c-green);
        }
        .callout strong { color: var(--c-navy); }

        /* Method badges */
        .method {
            display: inline-block;
            font-family: var(--font-mono);
            font-size: 11px;
            font-weight: 700;
            padding: 1px 6px;
            border-radius: 3px;
        }
        .method.post { background: rgba(0, 150, 57, 0.15); color: var(--c-green); }
        .method.get { background: rgba(0, 85, 135, 0.15); color: var(--c-peacock); }

        /* Response sample */
        .response-arrow {
            font-size: 12px;
            color: var(--c-gray);
            margin: 8px 0 4px;
            font-weight: 700;
        }

        /* Field table */
        .field-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin: 12px 0 16px;
        }
        .field-table th {
            background: var(--c-navy);
            color: white;
            padding: 8px 12px;
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .field-table td {
            padding: 7px 12px;
            border-bottom: 1px solid var(--border);
        }
        .field-table tr:hover { background: rgba(0, 85, 135, 0.03); }
        .field-table .required { color: var(--c-red); font-weight: 700; }

        /* Workflow diagram */
        .workflow {
            display: flex;
            align-items: center;
            gap: 0;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .wf-box {
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            text-align: center;
            min-width: 110px;
        }
        .wf-box.pending { background: rgba(242, 169, 0, 0.15); color: #B87D00; }
        .wf-box.approved { background: rgba(0, 150, 57, 0.15); color: var(--c-green); }
        .wf-box.rejected { background: rgba(208, 0, 43, 0.15); color: var(--c-red); }
        .wf-box.active { background: rgba(0, 150, 57, 0.25); color: #006B25; }
        .wf-box.node { background: rgba(0, 85, 135, 0.1); color: var(--c-peacock); }
        .wf-arrow {
            font-size: 18px;
            color: var(--c-gray);
            padding: 0 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Developer Guide &mdash; Moniker Request API</h1>
        <div class="header-nav">
            <a href="/requests/ui">Review Queue</a>
            <a href="/">Home</a>
            <a href="/docs">Swagger</a>
        </div>
    </div>

    <div class="page">
        <nav class="sidebar">
            <h3>On this page</h3>
            <a href="#overview">Overview</a>
            <a href="#quickstart">Quick Start</a>
            <a href="#workflow">Workflow</a>
            <div class="sep"></div>
            <a href="#step1">1. Submit a Request</a>
            <a href="#step2">2. Check Status</a>
            <a href="#step3">3. Add Comments</a>
            <a href="#step4">4. Approve or Reject</a>
            <a href="#step5">5. List &amp; Filter</a>
            <div class="sep"></div>
            <a href="#fields">Field Reference</a>
            <a href="#errors">Error Handling</a>
            <a href="#full-script">Full Script</a>
        </nav>

        <main class="content">

            <!-- ============================================================ -->
            <h2 id="overview">Overview</h2>

            <p>
                The Moniker Request API lets teams programmatically request new data monikers.
                Each request enters a governance review queue where it can be approved, rejected,
                or sent back for changes. On approval the moniker goes live in the catalog.
            </p>

            <p><strong>Base URL:</strong> <code>http://&lt;host&gt;:8050</code></p>

            <p>All endpoints accept and return <strong>JSON</strong>. No authentication is required in the current deployment.</p>

            <div class="callout info">
                <strong>Tip:</strong> You can also submit requests through the
                <a href="/requests/ui" style="color:var(--c-peacock);font-weight:700">Review Queue UI</a>
                using the "+ New Request" button &mdash; the form calls the same API under the hood.
            </div>

            <!-- ============================================================ -->
            <h2 id="quickstart">Quick Start</h2>

            <p>Submit your first moniker request &mdash; pick your language:</p>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 'qs')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 'qs')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="qs" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — minimal submit<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">import</span> requests

BASE <span class="op">=</span> <span class="str">"http://localhost:8050"</span>

resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests"</span>, json<span class="op">=</span>{
    <span class="key">"path"</span>:          <span class="str">"market-data/bonds/treasury"</span>,
    <span class="key">"justification"</span>: <span class="str">"Need treasury prices for risk analytics"</span>,
    <span class="key">"requester"</span>:     {<span class="key">"name"</span>: <span class="str">"Alice Smith"</span>, <span class="key">"email"</span>: <span class="str">"alice@firm.com"</span>},
})

<span class="fn">print</span>(resp.json())
<span class="cmt"># {'request_id': 'REQ-0001', 'path': 'market-data/bonds/treasury',
#  'status': 'pending_review', 'message': 'Request submitted for review'}</span></pre>
                </div>
            </div>
            <div class="lang-panel" data-group="qs" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — minimal submit<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">const</span> BASE <span class="op">=</span> <span class="str">"http://localhost:8050"</span>;

<span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests`</span>, {
    <span class="prop">method</span>: <span class="str">"POST"</span>,
    <span class="prop">headers</span>: { <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span> },
    <span class="prop">body</span>: JSON.<span class="fn">stringify</span>({
        <span class="key">"path"</span>:          <span class="str">"market-data/bonds/treasury"</span>,
        <span class="key">"justification"</span>: <span class="str">"Need treasury prices for risk analytics"</span>,
        <span class="key">"requester"</span>:     { <span class="key">"name"</span>: <span class="str">"Alice Smith"</span>, <span class="key">"email"</span>: <span class="str">"alice@firm.com"</span> },
    }),
});

<span class="kw">const</span> result <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
console.<span class="fn">log</span>(result);
<span class="cmt">// {request_id: "REQ-0001", path: "market-data/bonds/treasury",
//  status: "pending_review", message: "Request submitted for review"}</span></pre>
                </div>
            </div>

            <p>That's it. Your request is now visible in the <a href="/requests/ui" style="color:var(--c-peacock)">Review Queue</a> for governance reviewers.</p>

            <!-- ============================================================ -->
            <h2 id="workflow">How the Workflow Works</h2>

            <p>When you submit a request, two things happen simultaneously:</p>
            <ol>
                <li>A <strong>MonikerRequest</strong> is created in the request registry (tracks the review workflow)</li>
                <li>A <strong>CatalogNode</strong> is created with status <code>PENDING_REVIEW</code> (reserves the path in the catalog)</li>
            </ol>

            <div class="workflow">
                <div class="wf-box pending">PENDING_REVIEW</div>
                <div class="wf-arrow">&rarr;</div>
                <div class="wf-box approved">APPROVED</div>
                <div class="wf-arrow">&rarr;</div>
                <div class="wf-box active">Catalog: ACTIVE</div>
            </div>
            <div class="workflow" style="margin-top:4px">
                <div class="wf-box pending">PENDING_REVIEW</div>
                <div class="wf-arrow">&rarr;</div>
                <div class="wf-box rejected">REJECTED</div>
                <div class="wf-arrow">&rarr;</div>
                <div class="wf-box node">Catalog: DRAFT</div>
            </div>

            <div class="callout warn">
                <strong>Domain guard:</strong> If your path has multiple segments (e.g. <code>market-data/bonds</code>),
                the top-level domain (<code>market-data</code>) must already exist in the catalog.
                Single-segment paths are treated as <strong>top-level domain requests</strong> and require elevated governance approval.
            </div>

            <!-- ============================================================ -->
            <h2 id="step1">Step 1 &mdash; Submit a Request</h2>

            <div class="step">
                <div class="step-num">1</div>
                <div class="step-text">
                    <h3><span class="method post">POST</span> /requests</h3>
                    <p>Submit a new moniker request with ownership details, source binding, and justification.</p>
                </div>
            </div>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 's1')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 's1')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="s1" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — full request with all fields<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">import</span> requests

BASE <span class="op">=</span> <span class="str">"http://localhost:8050"</span>

payload <span class="op">=</span> {
    <span class="cmt"># --- The moniker you want to register ---</span>
    <span class="key">"path"</span>:          <span class="str">"market-data/bonds/treasury"</span>,   <span class="cmt"># required</span>
    <span class="key">"display_name"</span>:  <span class="str">"Treasury Bonds"</span>,               <span class="cmt"># optional, shown in catalog</span>
    <span class="key">"description"</span>:   <span class="str">"US Treasury bond prices, daily"</span>, <span class="cmt"># optional</span>
    <span class="key">"justification"</span>: <span class="str">"Required for fixed-income risk analytics dashboard"</span>,  <span class="cmt"># required</span>
    <span class="key">"tags"</span>:          [<span class="str">"bonds"</span>, <span class="str">"govies"</span>, <span class="str">"fixed-income"</span>],

    <span class="cmt"># --- Who is requesting it ---</span>
    <span class="key">"requester"</span>: {
        <span class="key">"name"</span>:   <span class="str">"Alice Smith"</span>,        <span class="cmt"># required</span>
        <span class="key">"email"</span>:  <span class="str">"alice@firm.com"</span>,      <span class="cmt"># required</span>
        <span class="key">"team"</span>:   <span class="str">"Data Engineering"</span>,    <span class="cmt"># optional</span>
        <span class="key">"app_id"</span>: <span class="str">"data-portal"</span>,         <span class="cmt"># optional — which app needs it</span>
    },

    <span class="cmt"># --- Proposed ownership (governance roles) ---</span>
    <span class="key">"adop"</span>:      <span class="str">"jane@firm.com"</span>,       <span class="cmt"># Accountable Data Owner — system ID</span>
    <span class="key">"adop_name"</span>: <span class="str">"Jane Doe"</span>,            <span class="cmt"># human-readable name</span>
    <span class="key">"ads"</span>:       <span class="str">"bob@firm.com"</span>,        <span class="cmt"># Accountable Data Specialist</span>
    <span class="key">"ads_name"</span>:  <span class="str">"Bob Smith"</span>,
    <span class="key">"adal"</span>:      <span class="str">"carol@firm.com"</span>,      <span class="cmt"># Accountable Data Asset Lead</span>
    <span class="key">"adal_name"</span>: <span class="str">"Carol Williams"</span>,

    <span class="cmt"># --- Where the data lives (optional) ---</span>
    <span class="key">"source_binding_type"</span>: <span class="str">"snowflake"</span>,
    <span class="key">"source_binding_config"</span>: {
        <span class="str">"account"</span>:   <span class="str">"firm.us-east-1"</span>,
        <span class="str">"warehouse"</span>: <span class="str">"ANALYTICS_WH"</span>,
        <span class="str">"database"</span>:  <span class="str">"MARKET_DATA"</span>,
        <span class="str">"schema"</span>:    <span class="str">"BONDS"</span>,
    },
}

resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests"</span>, json<span class="op">=</span>payload)
resp.<span class="fn">raise_for_status</span>()

result <span class="op">=</span> resp.json()
<span class="fn">print</span>(f<span class="str">"Request created: {result['request_id']}"</span>)
<span class="fn">print</span>(f<span class="str">"Status:          {result['status']}"</span>)
<span class="fn">print</span>(f<span class="str">"Message:         {result['message']}"</span>)</pre>
                </div>
            </div>
            <div class="lang-panel" data-group="s1" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — full request with all fields<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">const</span> BASE <span class="op">=</span> <span class="str">"http://localhost:8050"</span>;

<span class="kw">const</span> payload <span class="op">=</span> {
    <span class="cmt">// --- The moniker you want to register ---</span>
    <span class="key">"path"</span>:          <span class="str">"market-data/bonds/treasury"</span>,   <span class="cmt">// required</span>
    <span class="key">"display_name"</span>:  <span class="str">"Treasury Bonds"</span>,               <span class="cmt">// optional, shown in catalog</span>
    <span class="key">"description"</span>:   <span class="str">"US Treasury bond prices, daily"</span>, <span class="cmt">// optional</span>
    <span class="key">"justification"</span>: <span class="str">"Required for fixed-income risk analytics dashboard"</span>,
    <span class="key">"tags"</span>:          [<span class="str">"bonds"</span>, <span class="str">"govies"</span>, <span class="str">"fixed-income"</span>],

    <span class="cmt">// --- Who is requesting it ---</span>
    <span class="key">"requester"</span>: {
        <span class="key">"name"</span>:   <span class="str">"Alice Smith"</span>,
        <span class="key">"email"</span>:  <span class="str">"alice@firm.com"</span>,
        <span class="key">"team"</span>:   <span class="str">"Data Engineering"</span>,
        <span class="key">"app_id"</span>: <span class="str">"data-portal"</span>,
    },

    <span class="cmt">// --- Proposed ownership (governance roles) ---</span>
    <span class="key">"adop"</span>:      <span class="str">"jane@firm.com"</span>,       <span class="cmt">// Accountable Data Owner</span>
    <span class="key">"adop_name"</span>: <span class="str">"Jane Doe"</span>,
    <span class="key">"ads"</span>:       <span class="str">"bob@firm.com"</span>,        <span class="cmt">// Accountable Data Specialist</span>
    <span class="key">"ads_name"</span>:  <span class="str">"Bob Smith"</span>,
    <span class="key">"adal"</span>:      <span class="str">"carol@firm.com"</span>,      <span class="cmt">// Accountable Data Asset Lead</span>
    <span class="key">"adal_name"</span>: <span class="str">"Carol Williams"</span>,

    <span class="cmt">// --- Where the data lives (optional) ---</span>
    <span class="key">"source_binding_type"</span>: <span class="str">"snowflake"</span>,
    <span class="key">"source_binding_config"</span>: {
        <span class="key">"account"</span>:   <span class="str">"firm.us-east-1"</span>,
        <span class="key">"warehouse"</span>: <span class="str">"ANALYTICS_WH"</span>,
        <span class="key">"database"</span>:  <span class="str">"MARKET_DATA"</span>,
        <span class="key">"schema"</span>:    <span class="str">"BONDS"</span>,
    },
};

<span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests`</span>, {
    <span class="prop">method</span>: <span class="str">"POST"</span>,
    <span class="prop">headers</span>: { <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span> },
    <span class="prop">body</span>: JSON.<span class="fn">stringify</span>(payload),
});

<span class="kw">if</span> (!resp.<span class="prop">ok</span>) <span class="kw">throw new</span> Error(<span class="str">`HTTP ${resp.status}`</span>);

<span class="kw">const</span> result <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
console.<span class="fn">log</span>(<span class="str">`Request created: ${result.request_id}`</span>);
console.<span class="fn">log</span>(<span class="str">`Status:          ${result.status}`</span>);
console.<span class="fn">log</span>(<span class="str">`Message:         ${result.message}`</span>);</pre>
                </div>
            </div>

            <div class="response-arrow">Response:</div>
            <div class="code-block">
                <div class="code-label">JSON<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre>{
    <span class="key">"request_id"</span>: <span class="str">"REQ-0001"</span>,
    <span class="key">"path"</span>:       <span class="str">"market-data/bonds/treasury"</span>,
    <span class="key">"status"</span>:     <span class="str">"pending_review"</span>,
    <span class="key">"message"</span>:    <span class="str">"Request submitted for review"</span>
}</pre>
            </div>

            <div class="callout info">
                <strong>Save the <code>request_id</code></strong> — you'll need it to check status, add comments, or track the request through approval.
            </div>

            <!-- ============================================================ -->
            <h2 id="step2">Step 2 &mdash; Check Request Status</h2>

            <div class="step">
                <div class="step-num">2</div>
                <div class="step-text">
                    <h3><span class="method get">GET</span> /requests/{request_id}</h3>
                    <p>Poll or check the status of your submitted request.</p>
                </div>
            </div>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 's2')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 's2')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="s2" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — check status<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre>request_id <span class="op">=</span> <span class="str">"REQ-0001"</span>

resp <span class="op">=</span> requests.<span class="fn">get</span>(f<span class="str">"{BASE}/requests/{request_id}"</span>)
req <span class="op">=</span> resp.json()

<span class="fn">print</span>(f<span class="str">"Path:        {req['path']}"</span>)
<span class="fn">print</span>(f<span class="str">"Status:      {req['status']}"</span>)
<span class="fn">print</span>(f<span class="str">"Reviewed by: {req['reviewed_by'] or 'Pending'}"</span>)
<span class="fn">print</span>(f<span class="str">"Comments:    {len(req['comments'])}"</span>)

<span class="kw">if</span> req[<span class="str">"status"</span>] <span class="op">==</span> <span class="str">"approved"</span>:
    <span class="fn">print</span>(<span class="str">"Your moniker is live! Resolve it via /describe/{path}"</span>)
<span class="kw">elif</span> req[<span class="str">"status"</span>] <span class="op">==</span> <span class="str">"rejected"</span>:
    <span class="fn">print</span>(f<span class="str">"Rejected: {req['rejection_reason']}"</span>)</pre>
                </div>
            </div>
            <div class="lang-panel" data-group="s2" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — check status<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">const</span> requestId <span class="op">=</span> <span class="str">"REQ-0001"</span>;

<span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests/${requestId}`</span>);
<span class="kw">const</span> req <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();

console.<span class="fn">log</span>(<span class="str">`Path:        ${req.path}`</span>);
console.<span class="fn">log</span>(<span class="str">`Status:      ${req.status}`</span>);
console.<span class="fn">log</span>(<span class="str">`Reviewed by: ${req.reviewed_by || "Pending"}`</span>);
console.<span class="fn">log</span>(<span class="str">`Comments:    ${req.comments.length}`</span>);

<span class="kw">if</span> (req.<span class="prop">status</span> <span class="op">===</span> <span class="str">"approved"</span>) {
    console.<span class="fn">log</span>(<span class="str">"Your moniker is live! Resolve it via /describe/{path}"</span>);
} <span class="kw">else if</span> (req.<span class="prop">status</span> <span class="op">===</span> <span class="str">"rejected"</span>) {
    console.<span class="fn">log</span>(<span class="str">`Rejected: ${req.rejection_reason}`</span>);
}</pre>
                </div>
            </div>

            <!-- ============================================================ -->
            <h2 id="step3">Step 3 &mdash; Add Comments</h2>

            <div class="step">
                <div class="step-num">3</div>
                <div class="step-text">
                    <h3><span class="method post">POST</span> /requests/{request_id}/comment</h3>
                    <p>Respond to reviewer questions or add context to your request.</p>
                </div>
            </div>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 's3')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 's3')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="s3" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — add a comment<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre>request_id <span class="op">=</span> <span class="str">"REQ-0001"</span>

resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests/{request_id}/comment"</span>, json<span class="op">=</span>{
    <span class="key">"author"</span>:      <span class="str">"alice@firm.com"</span>,
    <span class="key">"author_name"</span>: <span class="str">"Alice Smith"</span>,
    <span class="key">"content"</span>:     <span class="str">"Updated the warehouse config per DBA team feedback."</span>,
})

<span class="fn">print</span>(f<span class="str">"Comment added. Total comments: {len(resp.json()['comments'])}"</span>)</pre>
                </div>
            </div>
            <div class="lang-panel" data-group="s3" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — add a comment<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">const</span> requestId <span class="op">=</span> <span class="str">"REQ-0001"</span>;

<span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests/${requestId}/comment`</span>, {
    <span class="prop">method</span>: <span class="str">"POST"</span>,
    <span class="prop">headers</span>: { <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span> },
    <span class="prop">body</span>: JSON.<span class="fn">stringify</span>({
        <span class="key">"author"</span>:      <span class="str">"alice@firm.com"</span>,
        <span class="key">"author_name"</span>: <span class="str">"Alice Smith"</span>,
        <span class="key">"content"</span>:     <span class="str">"Updated the warehouse config per DBA team feedback."</span>,
    }),
});

<span class="kw">const</span> updated <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
console.<span class="fn">log</span>(<span class="str">`Comment added. Total comments: ${updated.comments.length}`</span>);</pre>
                </div>
            </div>

            <!-- ============================================================ -->
            <h2 id="step4">Step 4 &mdash; Approve or Reject (Reviewers)</h2>

            <p>These endpoints are for governance reviewers. On <strong>approval</strong>, the catalog node goes live (<code>ACTIVE</code>). On <strong>rejection</strong>, it reverts to <code>DRAFT</code>.</p>

            <h3>Approve a request</h3>

            <div class="step">
                <div class="step-num">A</div>
                <div class="step-text">
                    <h3><span class="method post">POST</span> /requests/{request_id}/approve</h3>
                    <p>Approve the request — makes the moniker live in the catalog.</p>
                </div>
            </div>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 's4a')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 's4a')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="s4a" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — approve<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre>request_id <span class="op">=</span> <span class="str">"REQ-0001"</span>

resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests/{request_id}/approve"</span>, json<span class="op">=</span>{
    <span class="key">"actor"</span>:      <span class="str">"reviewer@firm.com"</span>,
    <span class="key">"actor_name"</span>: <span class="str">"Senior Reviewer"</span>,
    <span class="key">"reason"</span>:     <span class="str">"Ownership verified. Source binding confirmed with DBA team."</span>,
})

result <span class="op">=</span> resp.json()
<span class="fn">print</span>(f<span class="str">"Status: {result['status']}"</span>)  <span class="cmt"># "approved"</span>

<span class="cmt"># The moniker is now live — verify via the catalog:</span>
desc <span class="op">=</span> requests.<span class="fn">get</span>(f<span class="str">"{BASE}/describe/market-data/bonds/treasury"</span>).json()
<span class="fn">print</span>(f<span class="str">"Catalog status: {desc['status']}"</span>)  <span class="cmt"># "active"</span></pre>
                </div>
            </div>
            <div class="lang-panel" data-group="s4a" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — approve<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">const</span> requestId <span class="op">=</span> <span class="str">"REQ-0001"</span>;

<span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests/${requestId}/approve`</span>, {
    <span class="prop">method</span>: <span class="str">"POST"</span>,
    <span class="prop">headers</span>: { <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span> },
    <span class="prop">body</span>: JSON.<span class="fn">stringify</span>({
        <span class="key">"actor"</span>:      <span class="str">"reviewer@firm.com"</span>,
        <span class="key">"actor_name"</span>: <span class="str">"Senior Reviewer"</span>,
        <span class="key">"reason"</span>:     <span class="str">"Ownership verified. Source binding confirmed with DBA team."</span>,
    }),
});

<span class="kw">const</span> result <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
console.<span class="fn">log</span>(<span class="str">`Status: ${result.status}`</span>);  <span class="cmt">// "approved"</span>

<span class="cmt">// The moniker is now live — verify via the catalog:</span>
<span class="kw">const</span> desc <span class="op">=</span> <span class="kw">await</span> (<span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/describe/market-data/bonds/treasury`</span>)).<span class="fn">json</span>();
console.<span class="fn">log</span>(<span class="str">`Catalog status: ${desc.status}`</span>);  <span class="cmt">// "active"</span></pre>
                </div>
            </div>

            <h3>Reject a request</h3>

            <div class="step">
                <div class="step-num">R</div>
                <div class="step-text">
                    <h3><span class="method post">POST</span> /requests/{request_id}/reject</h3>
                    <p>Reject with a reason — the requester sees the feedback.</p>
                </div>
            </div>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 's4r')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 's4r')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="s4r" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — reject<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre>resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests/{request_id}/reject"</span>, json<span class="op">=</span>{
    <span class="key">"actor"</span>:      <span class="str">"reviewer@firm.com"</span>,
    <span class="key">"actor_name"</span>: <span class="str">"Senior Reviewer"</span>,
    <span class="key">"reason"</span>:     <span class="str">"Missing data classification. Please resubmit with DLP tier."</span>,
})

<span class="fn">print</span>(f<span class="str">"Status: {resp.json()['status']}"</span>)  <span class="cmt"># "rejected"</span></pre>
                </div>
            </div>
            <div class="lang-panel" data-group="s4r" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — reject<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests/${requestId}/reject`</span>, {
    <span class="prop">method</span>: <span class="str">"POST"</span>,
    <span class="prop">headers</span>: { <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span> },
    <span class="prop">body</span>: JSON.<span class="fn">stringify</span>({
        <span class="key">"actor"</span>:      <span class="str">"reviewer@firm.com"</span>,
        <span class="key">"actor_name"</span>: <span class="str">"Senior Reviewer"</span>,
        <span class="key">"reason"</span>:     <span class="str">"Missing data classification. Please resubmit with DLP tier."</span>,
    }),
});

<span class="kw">const</span> result <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
console.<span class="fn">log</span>(<span class="str">`Status: ${result.status}`</span>);  <span class="cmt">// "rejected"</span></pre>
                </div>
            </div>

            <!-- ============================================================ -->
            <h2 id="step5">Step 5 &mdash; List &amp; Filter Requests</h2>

            <div class="step">
                <div class="step-num">5</div>
                <div class="step-text">
                    <h3><span class="method get">GET</span> /requests</h3>
                    <p>List all requests, or filter by status to find what needs attention.</p>
                </div>
            </div>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 's5')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 's5')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="s5" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — list and filter<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="cmt"># List all requests</span>
resp <span class="op">=</span> requests.<span class="fn">get</span>(f<span class="str">"{BASE}/requests"</span>)
data <span class="op">=</span> resp.json()

<span class="fn">print</span>(f<span class="str">"Total requests: {data['total']}"</span>)
<span class="fn">print</span>(f<span class="str">"Pending:  {data['by_status'].get('pending_review', 0)}"</span>)
<span class="fn">print</span>(f<span class="str">"Approved: {data['by_status'].get('approved', 0)}"</span>)
<span class="fn">print</span>(f<span class="str">"Rejected: {data['by_status'].get('rejected', 0)}"</span>)

<span class="fn">print</span>(<span class="str">"\nAll requests:"</span>)
<span class="kw">for</span> req <span class="kw">in</span> data[<span class="str">"requests"</span>]:
    <span class="fn">print</span>(f<span class="str">"  {req['request_id']:10s}  {req['path']:40s}  [{req['status']}]"</span>)

<span class="cmt"># Filter by status</span>
pending <span class="op">=</span> requests.<span class="fn">get</span>(f<span class="str">"{BASE}/requests"</span>, params<span class="op">=</span>{<span class="key">"status"</span>: <span class="str">"pending_review"</span>}).json()
<span class="fn">print</span>(f<span class="str">"\n{pending['total']} pending requests"</span>)</pre>
                </div>
            </div>
            <div class="lang-panel" data-group="s5" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — list and filter<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="cmt">// List all requests</span>
<span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests`</span>);
<span class="kw">const</span> data <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();

console.<span class="fn">log</span>(<span class="str">`Total requests: ${data.total}`</span>);
console.<span class="fn">log</span>(<span class="str">`Pending:  ${data.by_status.pending_review || 0}`</span>);
console.<span class="fn">log</span>(<span class="str">`Approved: ${data.by_status.approved || 0}`</span>);
console.<span class="fn">log</span>(<span class="str">`Rejected: ${data.by_status.rejected || 0}`</span>);

console.<span class="fn">log</span>(<span class="str">"\nAll requests:"</span>);
<span class="kw">for</span> (<span class="kw">const</span> req <span class="kw">of</span> data.<span class="prop">requests</span>) {
    console.<span class="fn">log</span>(<span class="str">`  ${req.request_id.padEnd(10)}  ${req.path.padEnd(40)}  [${req.status}]`</span>);
}

<span class="cmt">// Filter by status</span>
<span class="kw">const</span> pending <span class="op">=</span> <span class="kw">await</span> (<span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests?status=pending_review`</span>)).<span class="fn">json</span>();
console.<span class="fn">log</span>(<span class="str">`\n${pending.total} pending requests`</span>);</pre>
                </div>
            </div>

            <div class="callout info">
                <strong>Available status filters:</strong>
                <code>pending_review</code>,
                <code>approved</code>,
                <code>rejected</code>,
                <code>draft</code>,
                <code>active</code>
            </div>

            <!-- ============================================================ -->
            <h2 id="fields">Field Reference</h2>

            <h3>Submit Request Body</h3>
            <table class="field-table">
                <thead>
                    <tr><th>Field</th><th>Type</th><th></th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>path</code></td><td>string</td><td class="required">required</td><td>Moniker path, e.g. <code>market-data/bonds</code></td></tr>
                    <tr><td><code>justification</code></td><td>string</td><td class="required">required</td><td>Business reason for the moniker</td></tr>
                    <tr><td><code>requester</code></td><td>object</td><td class="required">required</td><td>Must contain <code>name</code> and <code>email</code></td></tr>
                    <tr><td><code>requester.name</code></td><td>string</td><td class="required">required</td><td>Full name of the requester</td></tr>
                    <tr><td><code>requester.email</code></td><td>string</td><td class="required">required</td><td>Email address</td></tr>
                    <tr><td><code>requester.team</code></td><td>string</td><td></td><td>Team or department</td></tr>
                    <tr><td><code>requester.app_id</code></td><td>string</td><td></td><td>Application that needs the moniker</td></tr>
                    <tr><td><code>display_name</code></td><td>string</td><td></td><td>Human-readable name shown in catalogs</td></tr>
                    <tr><td><code>description</code></td><td>string</td><td></td><td>What data this moniker represents</td></tr>
                    <tr><td><code>adop</code> / <code>adop_name</code></td><td>string</td><td></td><td>Accountable Data Owner &mdash; system ID + human name</td></tr>
                    <tr><td><code>ads</code> / <code>ads_name</code></td><td>string</td><td></td><td>Accountable Data Specialist</td></tr>
                    <tr><td><code>adal</code> / <code>adal_name</code></td><td>string</td><td></td><td>Accountable Data Asset Lead</td></tr>
                    <tr><td><code>source_binding_type</code></td><td>string</td><td></td><td>snowflake, oracle, mssql, rest, excel, bloomberg, etc.</td></tr>
                    <tr><td><code>source_binding_config</code></td><td>object</td><td></td><td>Adapter-specific connection details (JSON)</td></tr>
                    <tr><td><code>tags</code></td><td>string[]</td><td></td><td>Classification tags for discovery</td></tr>
                </tbody>
            </table>

            <h3>Approve / Reject Body</h3>
            <table class="field-table">
                <thead>
                    <tr><th>Field</th><th>Type</th><th></th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>actor</code></td><td>string</td><td class="required">required</td><td>Reviewer's system ID / email</td></tr>
                    <tr><td><code>actor_name</code></td><td>string</td><td></td><td>Reviewer's display name</td></tr>
                    <tr><td><code>reason</code></td><td>string</td><td></td><td>Comment or reason (required for rejection)</td></tr>
                </tbody>
            </table>

            <h3>Comment Body</h3>
            <table class="field-table">
                <thead>
                    <tr><th>Field</th><th>Type</th><th></th><th>Description</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>author</code></td><td>string</td><td class="required">required</td><td>Commenter's system ID / email</td></tr>
                    <tr><td><code>author_name</code></td><td>string</td><td></td><td>Commenter's display name</td></tr>
                    <tr><td><code>content</code></td><td>string</td><td class="required">required</td><td>Comment text</td></tr>
                </tbody>
            </table>

            <!-- ============================================================ -->
            <h2 id="errors">Error Handling</h2>

            <p>The API returns standard HTTP status codes with a JSON <code>detail</code> field on error:</p>

            <table class="field-table">
                <thead>
                    <tr><th>Code</th><th>When</th><th>Example</th></tr>
                </thead>
                <tbody>
                    <tr><td><code>400</code></td><td>Bad request / validation</td><td>Parent domain doesn't exist, empty path</td></tr>
                    <tr><td><code>404</code></td><td>Request not found</td><td>Invalid request_id</td></tr>
                    <tr><td><code>409</code></td><td>Conflict</td><td>Path already exists or has a pending request</td></tr>
                </tbody>
            </table>

            <div class="lang-tabs">
                <button class="lang-tab active" onclick="switchLang(this, 'err')">Python</button>
                <button class="lang-tab" onclick="switchLang(this, 'err')">JavaScript</button>
            </div>
            <div class="lang-panel active" data-group="err" data-lang="Python">
                <div class="code-block">
                    <div class="code-label">Python — error handling<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre>resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests"</span>, json<span class="op">=</span>payload)

<span class="kw">if</span> resp.status_code <span class="op">==</span> <span class="num">409</span>:
    <span class="fn">print</span>(f<span class="str">"Conflict: {resp.json()['detail']}"</span>)
    <span class="cmt"># "Path already exists in catalog: market-data/bonds/treasury"</span>
    <span class="cmt"># "A pending request already exists for path: ..."</span>
<span class="kw">elif</span> resp.status_code <span class="op">==</span> <span class="num">400</span>:
    <span class="fn">print</span>(f<span class="str">"Validation error: {resp.json()['detail']}"</span>)
    <span class="cmt"># "Top-level domain 'xyz' does not exist. Create it first."</span>
<span class="kw">elif</span> resp.status_code <span class="op">>=</span> <span class="num">400</span>:
    <span class="fn">print</span>(f<span class="str">"Error {resp.status_code}: {resp.json()['detail']}"</span>)
<span class="kw">else</span>:
    <span class="fn">print</span>(f<span class="str">"Success: {resp.json()['request_id']}"</span>)</pre>
                </div>
            </div>
            <div class="lang-panel" data-group="err" data-lang="JavaScript">
                <div class="code-block">
                    <div class="code-label">JavaScript (fetch) — error handling<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="kw">const</span> resp <span class="op">=</span> <span class="kw">await</span> <span class="fn">fetch</span>(<span class="str">`${BASE}/requests`</span>, {
    <span class="prop">method</span>: <span class="str">"POST"</span>,
    <span class="prop">headers</span>: { <span class="str">"Content-Type"</span>: <span class="str">"application/json"</span> },
    <span class="prop">body</span>: JSON.<span class="fn">stringify</span>(payload),
});

<span class="kw">if</span> (resp.<span class="prop">status</span> <span class="op">===</span> <span class="num">409</span>) {
    <span class="kw">const</span> err <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
    console.<span class="fn">error</span>(<span class="str">`Conflict: ${err.detail}`</span>);
    <span class="cmt">// "Path already exists in catalog: market-data/bonds/treasury"</span>
    <span class="cmt">// "A pending request already exists for path: ..."</span>
} <span class="kw">else if</span> (resp.<span class="prop">status</span> <span class="op">===</span> <span class="num">400</span>) {
    <span class="kw">const</span> err <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
    console.<span class="fn">error</span>(<span class="str">`Validation error: ${err.detail}`</span>);
    <span class="cmt">// "Top-level domain 'xyz' does not exist. Create it first."</span>
} <span class="kw">else if</span> (!resp.<span class="prop">ok</span>) {
    <span class="kw">const</span> err <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
    console.<span class="fn">error</span>(<span class="str">`Error ${resp.status}: ${err.detail}`</span>);
} <span class="kw">else</span> {
    <span class="kw">const</span> result <span class="op">=</span> <span class="kw">await</span> resp.<span class="fn">json</span>();
    console.<span class="fn">log</span>(<span class="str">`Success: ${result.request_id}`</span>);
}</pre>
                </div>
            </div>

            <!-- ============================================================ -->
            <h2 id="full-script">Full End-to-End Script</h2>

            <p>Copy this script to walk through the entire lifecycle &mdash; submit, comment, approve, and verify:</p>

            <div class="code-block">
                <div class="code-label">Python — complete_workflow.py<button class="copy-btn" onclick="copyBlock(this)">Copy</button></div>
<pre><span class="str">"""
Complete moniker request workflow — submit, comment, approve, verify.
Run: python complete_workflow.py
"""</span>
<span class="kw">import</span> requests

BASE <span class="op">=</span> <span class="str">"http://localhost:8050"</span>

<span class="cmt"># ---------------------------------------------------------------</span>
<span class="cmt"># 1. Submit a new moniker request</span>
<span class="cmt"># ---------------------------------------------------------------</span>
<span class="fn">print</span>(<span class="str">"1. Submitting request..."</span>)
resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests"</span>, json<span class="op">=</span>{
    <span class="key">"path"</span>:          <span class="str">"market-data/bonds/treasury"</span>,
    <span class="key">"display_name"</span>:  <span class="str">"Treasury Bonds"</span>,
    <span class="key">"description"</span>:   <span class="str">"US Treasury bond prices, daily"</span>,
    <span class="key">"justification"</span>: <span class="str">"Required for fixed-income risk analytics"</span>,
    <span class="key">"requester"</span>: {
        <span class="key">"name"</span>:   <span class="str">"Alice Smith"</span>,
        <span class="key">"email"</span>:  <span class="str">"alice@firm.com"</span>,
        <span class="key">"team"</span>:   <span class="str">"Data Engineering"</span>,
        <span class="key">"app_id"</span>: <span class="str">"data-portal"</span>,
    },
    <span class="key">"adop"</span>: <span class="str">"jane@firm.com"</span>,  <span class="key">"adop_name"</span>: <span class="str">"Jane Doe"</span>,
    <span class="key">"ads"</span>:  <span class="str">"bob@firm.com"</span>,   <span class="key">"ads_name"</span>:  <span class="str">"Bob Smith"</span>,
    <span class="key">"source_binding_type"</span>:   <span class="str">"snowflake"</span>,
    <span class="key">"source_binding_config"</span>: {<span class="str">"account"</span>: <span class="str">"firm.us-east-1"</span>, <span class="str">"warehouse"</span>: <span class="str">"WH"</span>},
    <span class="key">"tags"</span>: [<span class="str">"bonds"</span>, <span class="str">"fixed-income"</span>],
})
resp.<span class="fn">raise_for_status</span>()
req_id <span class="op">=</span> resp.json()[<span class="str">"request_id"</span>]
<span class="fn">print</span>(f<span class="str">"   Created: {req_id}  status={resp.json()['status']}"</span>)

<span class="cmt"># ---------------------------------------------------------------</span>
<span class="cmt"># 2. Check the request status</span>
<span class="cmt"># ---------------------------------------------------------------</span>
<span class="fn">print</span>(<span class="str">"\n2. Checking status..."</span>)
req <span class="op">=</span> requests.<span class="fn">get</span>(f<span class="str">"{BASE}/requests/{req_id}"</span>).json()
<span class="fn">print</span>(f<span class="str">"   Path:   {req['path']}"</span>)
<span class="fn">print</span>(f<span class="str">"   Status: {req['status']}"</span>)

<span class="cmt"># ---------------------------------------------------------------</span>
<span class="cmt"># 3. Add a comment (requester provides extra context)</span>
<span class="cmt"># ---------------------------------------------------------------</span>
<span class="fn">print</span>(<span class="str">"\n3. Adding comment..."</span>)
requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests/{req_id}/comment"</span>, json<span class="op">=</span>{
    <span class="key">"author"</span>:      <span class="str">"alice@firm.com"</span>,
    <span class="key">"author_name"</span>: <span class="str">"Alice Smith"</span>,
    <span class="key">"content"</span>:     <span class="str">"DBA confirmed warehouse access. Data classified as Internal."</span>,
})
<span class="fn">print</span>(<span class="str">"   Comment added."</span>)

<span class="cmt"># ---------------------------------------------------------------</span>
<span class="cmt"># 4. Approve the request (reviewer action)</span>
<span class="cmt"># ---------------------------------------------------------------</span>
<span class="fn">print</span>(<span class="str">"\n4. Approving..."</span>)
resp <span class="op">=</span> requests.<span class="fn">post</span>(f<span class="str">"{BASE}/requests/{req_id}/approve"</span>, json<span class="op">=</span>{
    <span class="key">"actor"</span>:      <span class="str">"reviewer@firm.com"</span>,
    <span class="key">"actor_name"</span>: <span class="str">"Senior Reviewer"</span>,
    <span class="key">"reason"</span>:     <span class="str">"Ownership verified, source binding confirmed."</span>,
})
<span class="fn">print</span>(f<span class="str">"   Status: {resp.json()['status']}"</span>)

<span class="cmt"># ---------------------------------------------------------------</span>
<span class="cmt"># 5. Verify the moniker is live in the catalog</span>
<span class="cmt"># ---------------------------------------------------------------</span>
<span class="fn">print</span>(<span class="str">"\n5. Verifying in catalog..."</span>)
desc <span class="op">=</span> requests.<span class="fn">get</span>(f<span class="str">"{BASE}/describe/market-data/bonds/treasury"</span>)
<span class="kw">if</span> desc.status_code <span class="op">==</span> <span class="num">200</span>:
    <span class="fn">print</span>(f<span class="str">"   Catalog status: {desc.json().get('status', 'found')}"</span>)
    <span class="fn">print</span>(<span class="str">"   Moniker is LIVE!"</span>)
<span class="kw">else</span>:
    <span class="fn">print</span>(f<span class="str">"   Describe returned {desc.status_code}"</span>)

<span class="cmt"># ---------------------------------------------------------------</span>
<span class="cmt"># 6. List all requests — summary</span>
<span class="cmt"># ---------------------------------------------------------------</span>
<span class="fn">print</span>(<span class="str">"\n6. Request summary:"</span>)
data <span class="op">=</span> requests.<span class="fn">get</span>(f<span class="str">"{BASE}/requests"</span>).json()
<span class="fn">print</span>(f<span class="str">"   Total: {data['total']}"</span>)
<span class="kw">for</span> r <span class="kw">in</span> data[<span class="str">"requests"</span>]:
    <span class="fn">print</span>(f<span class="str">"   {r['request_id']:10s} {r['path']:40s} [{r['status']}]"</span>)

<span class="fn">print</span>(<span class="str">"\nDone."</span>)</pre>
            </div>

            <div class="callout success">
                <strong>That's the full lifecycle.</strong> Requesters submit via <code>POST /requests</code>,
                reviewers approve/reject, and the moniker automatically goes live in the catalog.
                The <a href="/requests/ui" style="color:var(--c-green);font-weight:700">Review Queue UI</a>
                provides the same workflow in a browser.
            </div>

        </main>
    </div>

    <script>
    function copyBlock(btn) {
        const pre = btn.closest('.code-block').querySelector('pre');
        const text = pre.textContent.trim();
        navigator.clipboard.writeText(text).then(() => {
            btn.textContent = 'Copied!';
            setTimeout(() => { btn.textContent = 'Copy'; }, 1500);
        });
    }

    // Language tab switching
    function switchLang(tabBtn, group) {
        const lang = tabBtn.textContent.trim();
        // Update tab active state
        const bar = tabBtn.parentElement;
        bar.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
        tabBtn.classList.add('active');
        // Show/hide panels
        document.querySelectorAll(`.lang-panel[data-group="${group}"]`).forEach(p => {
            p.classList.toggle('active', p.dataset.lang === lang);
        });
    }

    // Sidebar active state on scroll
    const sections = document.querySelectorAll('h2[id]');
    const navLinks = document.querySelectorAll('.sidebar a');
    window.addEventListener('scroll', () => {
        let current = '';
        sections.forEach(s => {
            if (window.scrollY >= s.offsetTop - 80) current = s.id;
        });
        navLinks.forEach(a => {
            a.classList.toggle('active', a.getAttribute('href') === '#' + current);
        });
    });
    </script>
</body>
</html>